
==== Front
J Math Biol
J Math Biol
Journal of Mathematical Biology
0303-6812
1432-1416
Springer Berlin Heidelberg Berlin/Heidelberg

38847854
2102
10.1007/s00285-024-02102-y
Article
A branching stochastic evolutionary model of the B-cell repertoire
http://orcid.org/0000-0003-1909-2542
Hyrien Ollivier ohyrien@fredhutch.org

1
Yanev Nikolay M. 2
1 https://ror.org/007ps6h72 grid.270240.3 0000 0001 2180 1622 Biostatistics, Bioinformatics, Epidemiology Program, Vaccine and Infectious Disease Division, Fred Hutchinson Cancer Center, Seattle, WA USA
2 grid.410344.6 0000 0001 2097 3094 Department of Operations Research, Probability and Statistics, Institute of Mathematics and Informatics, Bulgarian Academy of Sciences, Sofia, Bulgaria
7 6 2024
7 6 2024
2024
89 1 102 2 2023
15 9 2023
13 3 2024
© The Author(s) 2024
https://creativecommons.org/licenses/by/4.0/ Open Access This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons licence, and indicate if changes were made. The images or other third party material in this article are included in the article's Creative Commons licence, unless indicated otherwise in a credit line to the material. If material is not included in the article's Creative Commons licence and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this licence, visit http://creativecommons.org/licenses/by/4.0/.
We propose a stochastic framework to describe the evolution of the B-cell repertoire during germinal center (GC) reactions. Our model is formulated as a multitype age-dependent branching process with time-varying immigration. The immigration process captures the mechanism by which founder B cells initiate clones by gradually seeding GC over time, while the branching process describes the temporal evolution of the composition of these clones. The model assigns a type to each cell to represent attributes of interest. Examples of attributes include the binding affinity class of the B cells, their clonal family, or the nucleotide sequence of the heavy and light chains of their receptors. The process is generally non-Markovian. We present its properties, including as t→∞ when the process is supercritical, the most relevant case to study expansion of GC B cells. We introduce temporal alpha and beta diversity indices for multitype branching processes. We focus on the dynamics of clonal dominance, highlighting its non-stationarity, and the accumulation of somatic hypermutations in the context of sequential immunization. We evaluate the impact of the ongoing seeding of GC by founder B cells on the dynamics of the B-cell repertoire, and quantify the effect of precursor frequency and antigen availability on the timing of GC entry. An application of the model illustrates how it may help with interpretation of BCR sequencing data.

Keywords

Multitype branching process
Temporal alpha and beta diversity
Convergent evolution
Germinal center
Sequential immunization
Mathematics Subject Classification

60J80
60J85
NIHAI12951 Hyrien Ollivier http://dx.doi.org/10.13039/100000865 Bill and Melinda Gates Foundation OPP1151646 Hyrien Ollivier issue-copyright-statement© Springer-Verlag GmbH Germany, part of Springer Nature 2024
==== Body
pmcIntroduction

During an infection, the immune system initiates a response to protect the body from the invading pathogen and establish immunity against future reinfections. This response often relies on B cells, a class of lymphocytes specialized in the production of antibodies that neutralize invaders by binding to foreign target molecules on the pathogen called antigens. Since each antibody binds to specific molecules, a highly diverse B-cell repertoire is essential for achieving robust immune protection. While naive B cells express antibodies with considerable molecular diversity due to somatic recombination (Dreyer and Bennett 1965; Tonegawa 1983), the B-cell repertoire must undergo additional diversification to effectively respond to a vast array of evolving pathogens (Janeway et al. 2005).

The B-cell repertoire further diversifies during affinity maturation, the Darwinian evolutionary process that occurs in germinal centers (GC) (Janeway et al. 2005; MacLennan 1994; De Silva and Klein 2015). GC are temporary structures that develop in secondary lymphoid tissues such as lymph nodes, spleen, tonsils, and Peyer’s patches in the gut. They provide the microenvironment that supports and regulates adaptation of the B-cell repertoire to the invading pathogen. They are continually seeded by B cells selected for their ability to bind to the antigen (Schwickert et al. 2007). They include two distinct anatomical compartments, the dark and light zones, between which B cells traffic back and forth to undergo successive rounds of proliferation and somatic hypermutation followed by antigen-mediated selection (Eisen and Siskind 1964; Weigert et al. 1970; Jacob et al. 1991; Muramatsu et al. 2000). Somatic hypermutation occurs at an extraordinarily high rate estimated at ∼2×10-4-10-3 per base pair per generation which is about a million times greater than the mutation rate observed in other parts of the genome (Berek and Milstein 1987; McKean et al. 1984).

Understanding the rules of affinity maturation has major clinical applications. For example, several clinical trials currently in progress are testing novel HIV vaccines that seek to harness this process to elicit B cells able to secrete broadly neutralizing antibodies (bnAbs) similar to those isolated in people living with HIV (Leggat et al. 2022). By deciphering the rules governing antibody maturation, immunologists could manipulate GC to devise effective immunogens (i.e., molecules capable of inducing an immune response) and vaccination strategies aimed at preventing HIV acquisition and infection against other pathogens.

Mathematical models have played a crucial role in advancing our understanding of the dynamics of GC B cells, shedding light on this complex evolutionary system. Notably, pioneering work in the field can be found in (Agur et al. 1991; Kepler and Perelson 1993a, b, 1995; Oprea and Perelson 1997; Kleinstein and Singh 2001; Meyer-Hermann et al. 2001; Iber and Maini 2002) while a recent review is provided in Buchauser and Wadermann (2019). Many of these models are formulated as agent-based models that evaluate properties of GC via simulations. While this approach considers the stochastic nature of GC reactions, it may be computer-intensive and only yield conclusions for chosen parameter values. In this paper, we propose a comprehensive stochastic framework that allows for a more systematic exploration of properties across a range of plausible parameter values. We demonstrate the utility of this framework by showing that it predicts established properties of GC, while offering explanations for these properties and enabling the identification of new ones.

Somatic hypermutation and the competition between GC B cells are two central factors that structure evolution and adaptation of the B-cell repertoire. We propose a model that captures the most salient features of the process by assuming that the dynamics of GC B cells is controlled by three mechanisms: (1) the continual recruitment of founder B cells; (2) clonal expansion; and (3) somatic hypermutation of the BCR-encoding immunoglobulin (Ig) gene loci.

The continual recruitment of founder B cells induces an influx of B cells into GC and initiates the formation of clones (Schwickert et al. 2007, 2009; Turner et al. 2017). We model this mechanism using a counting process, potentially time-inhomogeneous. Evolution of B-cell clones is driven by cellular division, death, and differentiation, which we describe using an age-dependent branching process. Finally, accumulation of somatic hypermutations, the mechanism which randomly alters the binding properties of BCR, is captured by assigning a type to each cell and defining a network specifying the set of admissible transitions between types as cells divide. It is important to note that types need not represent nucleotide or amino acid sequences of BCR, but could instead reflect associated properties such as binding affinity classes or clonal families. Differences in the probability of death between types capture differential fitness (competition) between different types of B cells. The resulting model is a multitype age-dependent branching process with immigration, potentially time-varying, extending previously considered models (e.g., Sevastyanov 1957; Jagers 1968; Hyrien et al. 2005, 2017, 2015; Pakes and Kaplan 1974; Mitov et al. 2018; Slavtchova-Bojkova et al. 2023a, b; Yakovlev and Yanev 2006). The model allows tailored network architectures to study evolution of a variety of features of the BCR repertoire. Numerical methods have been proposed to implement these models (e.g., saddlepoint approximations to moments Hyrien et al. 2010).

We demonstrate the flexibility of the framework by studying three model structures. The first one classifies B cells according to their binding affinity for a given antigen (see Sect. 3.5.1). We show that, as a class, lower binding affinity B cells have a competitive advantage over their higher-affinity counterparts because of their propensity to engage in GC reactions earlier, attributed to their higher abundance. We also find that clonal families should contain B cells with diverse binding affinity levels that grow in size at the same rate within their respective clones, a finding aligning with previous observations (Kuraoka et al. 2016; Bannard and Cyster 2017). No definitive mechanisms have been put forth to explain this phenomenon; our model shows that it could be, in part, attributed to the combined effects of clonal expansion and somatic hypermutation (Sect. 3.7). Mathematically, this property emerges from the communication between cell types (or, equivalently, the irreducibility of the mean offspring matrix). From a biological standpoint, it results from the fact that somatic hypermutation may alter affinity for the antigen, and that these alterations can be reversed.

Several studies have shown that early GC harbor B cells from multiple clonal families, potentially hundreds, and gradually loose this clonal diversity to become oligoclonal (i.e., dominated by a few clones) (Kroese et al. 1987; Janeway et al. 2005; Faro and Or-Guil 2013; Tas et al. 2016). To study evolution of clonal dominance, we consider a second model in which each type identifies a clonal family. Analysis of the model supports that oligoclonality arises from differential binding affinity between clones. It also suggests that clonal dominance may be a temporary feature repeatedly lost to newer clones until the GC reaction stops (see Sects. 3.5.2, 5).Fig. 1 Principle of a successful sequential immunization strategy. The vaccine regimen begins with a priming immunogen seeking to induce B cells with genetic and molecular signatures expected to allow HIV bnAb production. B cells induced by the prime consist of both desired and non-desired (on- and off-target) B cells that express BCR with limited somatic hypermutations and lack the ability to neutralize the virus. To induce B cells with neutralizing activities, the immune system is boosted by a series of immunogens designed to support further maturation of B cells from clonal families induced by previous vaccine doses and select somatic hypermutations relevant for broad neutralization against HIV. After each vaccination, on-target B cells compete with off-target B cells for antigen-mediated selection

We introduce a third model designed to examine the divergence of BCR sequences from their unmutated (germline) ancestors, driven by the accumulation of somatic hypermutations. This model is relevant for characterizing the evolution of the B-cell repertoire in the context of immunization. Most vaccines achieve protection through induction of antibodies (Plotkin 2008). Protective vaccines against the human immunodeficiency virus (HIV) have remained elusive to date. However, about 20–30% of people with HIV infection develop bnAbs which neutralize many of the globally circulating HIV strains through binding conserved regions of the virus (Doria-Rose et al. 2009). VRC01 is one bnAb that specifically targets the CD4 binding site on the HIV virus. The efficacy of passive immunization with VRC01 against HIV acquisition was recently tested in two clinical trials which showed that protection against HIV infection by VRC01 was confined to viruses highly susceptible to neutralization (Corey et al. 2021). Novel vaccines that seek to induce HIV bnAbs via sequential immunization are currently being evaluated (Haynes and Mascola 2017; Leggat et al. 2022) (see Fig. 1 for a description of their principle). One challenging goal of this strategy is selection of somatic hypermutations similar to those of HIV bnAbs, including rare substitutions, capable of neutralizing the virus. One metric for assessing the vaccine-induced immune response is the distance between the sequences of vaccine-elicited BCR to that of a designated target bnAb. The third model describes the progression of these distances over time (Sect. 6).

The remainder of this paper is organized as follows. Section 2 provides a brief review of how antibodies are encoded and their structure. The general model is defined in Sect. 3; see Fig. 2 for a graphical overview. Section 3.2 discusses the model that describes the seeding of GC. Section 3.3 focuses on the particular case where this model is a time-inhomogeneous Poisson process. Section 3.4 presents the multitype branching process that describes clonal expansion and the impact of somatic hypermutation. The specific models introduced earlier are defined in Sect. 3.5. Model properties are presented in Sects. 3.6, 5 and 6 to explore patterns of the dynamics of GC reactions. Our study of clonal dominance relies on measuring the alpha and beta diversity of B-cell repertoires; these indices are presented in Sect. 4 in the general context of multitype branching processes. Throughout, results are discussed and illustrated in the context of sequential immunization, introduced in Sect. 6.1. Technical details (proofs) are provided in the Appendix.Fig. 2 Dynamics of germinal center B cells as captured by the proposed model. Founder B cells join the GC at random time points (T1,T2,T3,T4…). These arrival times are described by a point process, potentially time-inhomogeneous. Each founder B cell initiates a clonal family in which B cells either divide or die. Each cell is assigned a type at birth; when it divides it may produce offspring of different types (e.g., reflecting the impact of somatic hypermutations). In the example depicted here, the population includes two types of B cells, but more complex models with arbitrary number of types may be constructed

Encoding and structure of antibodies

Antibodies consist of four polypeptide chains arranged in two identical pairs, with each pair consisting of a heavy and a light chain connected by disulfide bonds (Fig. 3). The stem of the (Y-shaped) antibody molecule, called the constant region, determines the class of the antibody (IgG, IgA, IgM, IgD, and IgE). The tips of the antibody molecule are known as the antigen-binding regions or variable regions. The variable regions of the antibody molecule contains regions called complementarity-determining regions (CDR). There are three CDRs in both the variable heavy and variable light chains, denoted as CDR1, CDR2, and CDR3. These loops are the most variable parts of the antibody, and their unique sequences are responsible for antigen recognition. The unique sequence of amino acids in the CDRs allows each antibody to bind to a specific target antigen or a closely related group of antigens. Between the CDRs, there are four regions known as framework regions (FR1-FR4) which provide the structural scaffold for the variable region. While they are less variable than the CDRs, variations in the nucleotide sequence of the FRs can still affect the antigen-binding properties of the antibodies. The combination of the CDRs and the adjacent FRs forms the antigen-binding site of the antibody.

The genetic information encoding the variable regions is divided into multiple variable (V), diversity (D, only for heavy chains), and joining (J) gene segments. During B cell development, the DNA of the B cell randomly rearranges one gene segment from each V(D)J category per chain. The selected gene segments are joined together, and any excess DNA between them is removed. This process which takes place in the bone marrow is called somatic recombination. It results in a functional gene encoding the variable region of the antibody. Variable regions are approximately 110–130 amino acid long in heavy chains, and slightly shorter in light chains. Most positions are encoded by the V gene.

After the B cell encounters an antigen, it may undergo somatic hypermutation in the variable regions of its Ig genes. This process introduces random mutations into these genes, primarily in the CDRs. B cells with mutated antibodies that bind more effectively to the antigen receive a survival advantage and are selected for further proliferation, eventually leading to the production of high-affinity antibodies. Somatic hypermutation further improves these antibodies for optimal antigen recognition. This process produces more effective antibodies over time during an immune response. See Janeway et al. (2005) for further details.

Stochastic modeling of GC B-cell dynamics

Classification of B cells into types

All BCR expressed on the surface of a B cell (around 120,000; Alt et al. 2015, p. 154) share the same nucleotide sequence that determines their antigen specificity (Janeway et al. 2005; Alt et al. 2015). During a GC reaction, proliferating B cells accumulate somatic hypermutations in their Ig gene loci, causing BCR sequences to drift away from the original (naive) sequence assembled during somatic recombination. This evolutionary process, which enables adaptation of the B-cell repertoire, may be studied from many angles. Aside from the sequence of the B-cell receptors, relevant properties (attributes) include their binding affinity class and clonal family. We propose a unified modeling framework in which a generic type is assigned to each B cell. These types are indexed by a set K, and we let K=|K| denote the total number of types, possibly infinite, in the model. Types represent arbitrary attributes, but it may be convenient to identify them by the first K integers and set K={1,…,K} when useful. Every B cell is assumed to belong to one of these K types which induce a partition of the B-cell repertoire.Fig. 3 Structure of antibodies; see Sect. 2 for details

Seeding of germinal centers as a counting process

Schwickert et al. (2007) experimentally showed that GC are open structures that are continually visited and seeded by naive follicular B cells (Schwickert et al. 2007). We describe the ongoing seeding of GC using K type-specific immigration processes, one per cell type. These processes are formulated by defining K sequences of positive and increasing random variables (r.v.) {Tkℓ,ℓ=1,2…} where 0≤Tk1≤Tk2⋯ a.s., k∈K. Each of these sequences represents the successive time points at which type-k founder B cells join the GC reaction. The first type-k founder B cell enters the GC at time Tk1, the second one at time Tk2, and so on. The sequence {Tkℓ,ℓ=1,2…} generates a counting process Πk(t)=∑ℓ=1∞1{Tkℓ≤t}, t≥0, which represents the number of type-k founder B cells that have entered the GC by time t. Let {Tℓ,ℓ=1,2…}=⋃k∈K{Tkℓ,ℓ=1,2…} denote the collection of all time points at which founder B cells enter the GC, and define the overall immigration process1 Π(t)=∑ℓ=1∞1{Tℓ≤t}=∑k∈KΠk(t)(t≥0),

which represents the total number of founder B cells that have joined the GC by time t, regardless of type. The specification of the counting processes {Πk(·)}k∈K is context-dependent. Given its importance in applications, the Poisson process is treated in detail in the next section. An example where they are not defined as Poisson processes is given in Sects. 3.5.2 and 5.

A time-inhomogeneous Poisson race

Throughout this section, we assume that: {Πk(·)}k∈K are mutually independent Poisson processes with local intensities rk(t)>0 and mean measures Rk(t)=∫0trk(x)dx<∞, t≥0, k∈K.

The rate at which founder B cells enter GC has not been fully elucidated, and each Πk(·) could be formulated as a time-homogeneous Poisson process for simplicity. The ability of naive antigen-specific B cells to enter pre-existing GC is impacted by multiple factors, including antigen availability. Turner et al. (2017) showed that B cells that acquire a small amount of antigen can enter GC at any stage of the reaction; however, naive antigen-specific B cells may be recruited during a more restricted time window (within 6–10 days) (Turner et al. 2017). Taken together, these findings support specifying Πk(·) as a time-inhomogeneous Poisson process with rate r(·) functionally related to antigen availability.

We refer to Resnick (1992) and Durrett (2004) for discussions on Poisson processes, and recall the following useful five facts about them:Fact 1: P{Πk(t)=n}=Rk(t)ne-Rk(t)/n!, n=0,1…, k∈K, t≥0.

Fact 2: E(Πk(t))=Var(Πk(t))=Rk(t), k∈K, t≥0.

Fact 3: If Π1(·) and Π2(·) are independent, possibly time-inhomogeneous, Poisson processes with local intensities r1(·) and r2(·), then Π1(·)+Π2(·) is a Poisson process with local intensity r1(·)+r2(·).

Fact 4: If Π1(·)+Π2(·) jumps by one unit at time t, then the probability that the jump is due to Π1(·) is r1(t)/(r1(t)+r2(t)).

Fact 5: The time of arrival of the first type-k founder in the GC, Tk1, is a continuous r.v. with probability density function (p.d.f.) fk1(t)=rk(t)e-Rk(t), t≥0, and expectation μk1=∫0∞e-Rk(v)dv.

When K is finite, we deduce from Fact 3 that Π(·) is a Poisson process with local intensity r(·)=∑k∈Krk(·). When K=∞, this property still holds if R(t)=∑k∈KRk(t)<∞, t≥0.

To identify the type of the ℓ-th founder, define a r.v. Iℓ=(Iℓk,k∈K) where Iℓk denotes the number of type-k founder B cells that entered the GC at time Tℓ, ℓ=1,2…. We assume that a single B cell immigrates at each time Tℓ; hence, Iℓk∈{0,1} and ∑k∈KIℓk=1 with probability one. We also assume that {Iℓ}ℓ=1∞ are independent and identically distributed (i.i.d.) r.v. with p.g.f. g(s)=EsIℓ=∑k∈Kgksk where sα=∏k∈Kskk.

On occasion, we will make the following assumption: (A2) There exists positive constants {gk}k∈K such that ∑k∈Kgk=1 and rk(t)=gkr(t) for every t≥0 and k∈K.

Under Assumption (A2), temporal fluctuations in the influx of founder B cells remain identical across types, up to the multiplicative constants gk. Together with Fact 4, this implies that gk=rk(t)/∑i∈Kri(t) is the probability that a founder B cell that joins the GC at time t is of type k. Assumption (A2) implies that these probabilities remain unchanged throughout time, even when r(·) is time-dependent. When each process Πk(·), k∈K, is a time-homogeneous Poisson process with rate gkr0 for some constant r0∈(0,∞), then Π(·) is a time-homogeneous Poisson process with rate r(·)≡r0.

For every k∈K, the r.v. Tk1 denotes the waiting time until the first type-k founder enters the GC. According to Fact 5, Tk1 has a distribution with hazard rate rk(·). If immigration is time-homogeneous, with rk(t)=gkr0, t≥0, then Tk1∼Exp(gkr0). If rk(t)=gkr0tγ for some constants r0>0 and γ>-1, then Tk1 has a Weibull distribution with shape and scale parameters 1+γ and 1+γgkr011+γ, heavy tailed when the immigration rate decreases over time at a polynomial rate γ∈(-1,0). Its median and mean are 1+γgkr011+γln(2)11+γ and 1+γgkr011+γΓ1+11+γ where Γ(z)=∫0∞uz-1e-udu, and the ratio of the medians or means of the waiting time until first type-k and first type-k′ founders join the GC are both given by gk′/gk11+γ. We note that the assumption of a decreasing immigration rate may partly reflect current vaccination strategies where doses are typically administered as a bolus.Fig. 4 From left to right: median, mean, and ratio of medians (or means) of the time to first type-k founder joining the GC when the time-inhomogeneous Poisson process has local intensity rk(t)=gkr0tγ (r0=1). These parameters are plotted as a function of γ∈(-1,1)

Figure 4 shows the median, mean, and ratio of medians or means of Tk1 as a function of γ, for various values of the precursor frequency gk and of gk/gk′. As gk decreases, both the median and mean increase. The median is neither a decreasing nor monotone function of γ∈(0,∞): it increases for γ∈(-1,(gkr0e1-ln2)/ln2) and decreases for γ∈(gkr0e1-ln2)/ln2,∞). The ratio comparing the medians for two cell types (less versus more abundant) decreases for γ∈(-1,∞). When the influx of B cells recruited by the GC slows down (γ∈(-1,0)), the median waiting time is disproportionately longer for rarer cell types, and shorter when the influx accelerates. For instance, with an immigration rate decreasing at a rate of γ=-1/2 (i.e., rk(t)=gkr0t-1/2), every halving of the frequency of the founder B cells (i.e., gk/gk′=2) causes the median or mean waiting time to increase by a factor of 4 (=211-1/2), compared to 2 (=211-0) when immigration is stationary (rk(t)=gkr0, γ=0).

Remark 1

(Biological relevance) During an immune response, the recruitment of new B cells by GC may slow down when the amount of antigen that fuels the reaction decreases (Turner et al. 2017). The time until rare B cells (which tend to join the reaction later than more common ones, as discussed below and in Remark 2) join the GC may be longer than the waiting time for more common B cells. The fueling of GC by a continual supply of antigen, perhaps characteristic of chronic infections or GC in the gut, could increase the likelihood of rare B cells entering GC. This observation has clinical applications, particularly for the development of vaccines that seek to elicit responses from B cells with rare genetic and molecular signatures which could benefit from sustained immunogen delivery. A related phenomenon has been recently reported (Lee et al. 2022).

The recruitment of founder B cells into GC can be cast as a competition between classes of B cells that race against each other to place some of their members into the GC reaction. LetN(K1,K2):=∑k1∈K1Πk1(mink2∈K2Tk21)

denote the number of type-k1 founder B cells, k1∈K1, that have joined a given GC by the time the first type-k2 founder B cell, k2∈K2, joins the same GC; this time is mink2∈K2Tk21.

Suppose that K1 and K2 are two non-overlapping subsets of K, that Assumption (A2) holds, and ∑k∈K1∪K2Rk(t)<∞, t≥0. Then, ∑k1∈K1Πk1(t) and ∑k2∈K2Πk2(t) are independent Poisson processes, and N(K1,K2) has a geometric distribution with success probability ∑k2∈K2gk2/∑k∈K1∪K2gk which does not depend on r(·); that is,2 P{N(K1,K2)=n}=∑k2∈K2gk2∑k∈K1∪K2gk∑k1∈K1gk1∑k∈K1∪K2gkn(n=0,1…).

Moreover,3 ∑k2∈K2gk2∑k∈K1∪K2gkN(K1,K2)⟶DExp(1)as∑k2∈K2gk2∑k∈K1∪K2gk→0.

It immediately follows from (2) that E(N(K1,K2))=∑k1∈K1gk1∑k2∈K2gk2 and Var(N(K1,K2))=∑k1∈K1gk1∑k2∈K2gk22+∑k1∈K1gk1∑k2∈K2gk2. Thus, when Assumption (A2) holds, the mean number of type-k1 founder B cells, k1∈K1, joining the GC during the time interval [0,mink2∈K2Tk21] grows inversely proportional to the precursor frequency of type-k2 cells, k2∈K2: ∑k2∈K2gk2.

Remark 2

(Biological relevance) The proportions {gk,k∈K} represent the frequencies of antigen-specific B cells among each type of B-cell precursors recruited by GC. It has been estimated that, in humans, the frequency of VRC01-class CD4 binding site antibody precursors is about 1 in 2.4 million B cells. Precursors for other HIV-like bnAbs (e.g., PGT121) may be even more rare (Jardine et al. 2016; Steichen et al. 2016). The practical implication of the above results is that immunogens used by germline-targeting vaccines must substantially enrich the pool of on-target B-cells so they will not be outcompeted by off-target B cells selected for entry in GC induced by boost vaccination.

The continual seeding of GC has also implications on the diversification of the B-cell repertoire. Our results suggest that GC tend to be initially colonized by commonly found precursors (e.g., B cells founding clones with ‘average’ binding affinity potential, sufficient to enter GC) before they recruit the rarest ones (e.g., B cells able to produce high binding affinity B cells). By the time the first high affinity B cell joins the reaction, the GC will have been visited by many B cells with lower binding affinity potential. Each of these early founder B cells may initiate a clone at a time where competition for the antigen may not yet be at its peak. This mechanism may therefore support diversification of GC B cells during the earliest stage of the reaction. The waiting time until the highest binding affinity B cells join the reaction allows B cells with lower binding affinity to undergo somatic hypermutations, further diversifying the BCR repertoire. Thus, as a class, lower binding affinity B cells have a temporary competitive advantage over high binding affinity B cells due to the timing of their arrival which allows them to clonally expand. Although (rare) high binding affinity founder B cells tend to join GC later, their clones may still outnumber lower affinity clones if they have higher fitness. Another consequence of the continual seeding is clonal instability in the GC, a phenomenon studied in Sect. 5 which also diversifies the B-cell repertoire through the turnover of dominant clones.

Branching mechanism and intra-clonal evolution

For every k∈K, the lifespan of any type-k cell is described by a non-lattice r.v. τk with cumulative distribution function (c.d.f.) Gk(x)=P{τk≤x}, x∈[0,∞), with Gk(0)=0. At the end of its lifespan, every type-k cell produces a random number of offspring described by a r.v. ξk=(ξkj,j∈K) where ξkj denotes the number of type-j daughter cells. We assume that cells either die or divide; hence, ∑j∈Kξkj∈{0,2}. Let hk(s)=E∏j=1Ksjkj, s=(s1,⋯,sK), denote the probability generating function (p.g.f.) of ξk. Lastly, within a clone, every cell evolves independently of every other cell.

Let C(k) denote any type-k cell. Define p0k=P{C(k)→∅} and pijk=P{C(k)→(C(i),C(j))} where p0k is the probability that any type-k cell completes its lifespan without producing any offspring either because it dies, or differentiates into a plasma or memory B cell, or exits the GC; and pijk denotes the probability that any type-k cell divides into two cells of types i and j, respectively, with i,j,k∈K. Put p2k=1-p0k for the probability of division of any type-k cell. Let qijk=P{C(k)→(C(i),C(j))|C(k)divides}=pijk/(1-p0k) denote the conditional probability that any type-k cell divides into one type-i and one type-j cell. The conditional probabilities {qijk}i,j∈K capture the impact of somatic hypermutation on type-k cells that manifests at division. Notice that {C(k)→(C(i),C(j))}={C(k)→(C(j),C(i))}. Hence, for every k∈K, the p.g.f. hk(s) may be expressed as hk(s)=p0k+∑i∈K∑j=iKpijksisj, hk(1)=1.

Let mij=E(ξij)=∂hi(s)∂sj|s=1=∑n=1jpnji+∑n=jKpjni denote the expected number of type-j cells produced by any type-i cell at the end of its lifespan. Define the associated matrix of mean offspringM=m11⋯m1K⋮⋱⋮mK1⋯mKK,

and write mi=∑j∈Kmij for the total mean number of offspring produced by any type-i cell. Then, mij=(1-p0i)(∑n=1jqnji+∑n=jKqjni). Let βjki=∂2hi(s)∂sj∂sk|s=1=E{ξij(ξik-δik)} where δik=1{i=k}, for every i,j,k∈K.

Let Z(t)=(Zk(t))k∈K, t≥0, where Zk(t) is the number of type-k cells at time t, k∈K, generated by the above-defined multitype branching process. Put Z(t)=∑k=1KZk(t) for the size of the clonal family at time t.Fig. 5 Four examples of network architectures describing the interconnection between cell types. In each example, the nodes represent the types and the edges identify the set of admissible transitions between types. For simplicity, self-renewing division (without change in type) and cell death are not shown in the graphs. Architecture 1: The process includes five types, with each type representing a binding affinity class (from lowest (1) to highest (5)) positioned along two mutational pathways; type-1 cells may produce type-2 and type-3 cells, and vice versa, allowing offspring to reversibly enter either one of the pathways: type-2 cells are less likely than type-3 cells to produce offspring of highest affinity (type-5); this first example is introduced in Sect. 3.5.1. Architecture 2: The model includes countably many types, each type representing one of the clonal families seeding a GC, ranked in the order in which they join the GC; in this second example, introduced in Sect. 3.5.2, the types do not connect. Architecture 3: Each type in the model represents the nucleotide sequence of the immunoglobulin gene loci that encode the heavy and/or light chains of the BCR; in this third example, briefly introduced in Sect. 3.5.3, transitions between types arise through somatic hypermutation. Architecture 4: The model offers a simplified description of the accumulation of somatic mutations in the Ig gene loci of B cells; the state space is a 5-dimensional vector: its first two entries represent the number of mutated and unmutated positions among those at which the germline and a target bnAb match (ν11∪ν12); its last three entries represent the number of mutated and unmutated positions among those at which the germline and bnAb do not match (ν21∪ν22∪ν23); specifics about the model, in particular why three entries are needed in the latter case, are explained in Sect. 6

Examples of model structures

We consider a few illustrative examples of model structures, shown in Fig. 5.

Example 1: modeling evolution of binding affinity classes

The role of GC is to generate high binding affinity B cells through somatic hypermutation, antigen-mediated selection, and clonal expansion. Our first model classifies the B cells that populate a GC into types that each represents a binding affinity class for one of the antigens fueling the reaction. The affinity level of an antibody refers to its strength in binding to a specific antigen and the stability of the resulting complex. A higher affinity indicates a stronger interaction between the antibody and antigen.

Many clonal families originate from a founding B cell with a relatively low affinity, but nevertheless sufficient to secure entry into the GC. Their descendants are subjected to somatic hypermutation which may either leave binding affinity virtually unchanged or altered. When their affinity improves, B cells are more likely to persist in the GC, captured by a decrease in the probability of death (p0k). The branching mechanism and topology of the transition network are formulated to describe propagation of the members of a clonal family over the various affinity classes under a given scenario. The example shown in Fig. 5 allows two mutational pathways. Both of them enable enhancement of affinity, but one is a mutational dead-end, prematurely restricting improvement of affinity. It extends the catenary model studied in Kleinstein and Singh (2001).

Example 2: an infinite-type model of clonal dominance

In the second example, GC B cells are classified according to the founder B cell from which they descend: descendants of the first founder are all of type 1; descendants of the second founder are all of type 2; and so on. Thus, here, each type identifies a particular clonal family, types do not communicate with each other, K={1,2…}, and K=∞. The offspring mean matrix is4 M=21-p0100⋯01-p020⋯⋮⋱⋱,

and the lifespan of any type-k cell follows a distribution with c.d.f. Gk(·). We use this model to study the dynamics of clonal dominance within GC. The model predicts that GC are initially clonally highly diverse, before gradually loosing their clonal diversity and converging toward dominance by a few clonal families. These predictions corroborate previous experimental observations. Additionally, clones that dominate a GC reaction are eventually replaced by new ones, until the reaction stops.

Example 3: mutational gains and losses relative to a germline gene and a target antibody

Evolution of the BCR repertoire may be described at the sequence level by building a model in which each type represents the nucleotide sequence of a particular BCR and postulating how somatic hypermutations induce transitions between types at division (Fig. 5, architecture 3). However, the complexity of the rules of somatic hypermutation and affinity-based selection makes the formulation of such a model difficult (requiring specification of ≥4L(4L-1) transition probabilities for nucleotide sequences of length L). In this paper, we propose a simpler evolutionary model that focuses on gains and losses of mutations relative to a germline and a target antibody sequence. The model partitions positions of the heavy and/or light chain sequence into 5 distinct subsets to capture mutations at positions at which the bnAb and germline match or differ (Fig. 5, architecture 4; see also Sect. 6).

Properties of the general model

Let Xℓ, ℓ=1,2…, be i.i.d. r.v. representing the type of the ℓ-th founder B cell. When assumption (A1) holds, it follows from Fact 4 that P{Xℓ=k}=rk(t)/r(t), k∈K. Let Z(ℓ)(t)=(Zk(ℓ)(t),k∈K), t≥0, where Zk(ℓ)(t) denotes the number of type-k cells in the ℓ-th clone t units of time after its initiation, and with initial condition Z(ℓ)(0)=eXℓ where ek is a K-dimensional vector with all entries equal to 0 except for a one in the k-th place. We assume that: (A3) {Z(ℓ)(·)}ℓ=1∞ are i.i.d. copies of Z(·) started with one cell of type {Xℓ}ℓ=1∞.

Put F(t;s)=(Fk(t;s),k∈K) where Fk(t;s)=E(sZ(1)(t)|X1=k) denotes the conditional p.g.f. of Z(1)(t), given the process begins with one type-k cell. These p.g.f. are the unique solutions of the nonlinear integral equations:5 Fk(t;s)=∫0thk(F(t-u;s))dGk(u)+sk(1-Gk(t))(k∈K)

with boundary conditions Fk(0;s)=sk, k∈K [see Mode (1971), Athreya and Ney (1972)].

For every t≥0, define Akj(t)=E(Zj(1)(t)|Z(1)(0)=ek) and Bijk(t)=E(Zi(1)(t)(Zj(1)-δij)|Z(1)(0)=ek) where, for every i,j,k∈K, Akj(t) denotes the average number of type-j cells at time t in a clone started from a single type-k founder B cell of age 0 at time 0, Bijk(t) is the second-order factorial moment of the number of type-i and type-j cells at time t in a clone started from a single type-k cell at time 0, and δij=1 if i=j and 0 otherwise. Put A(t)=Ajk(t),j,k∈K. The variance of Zj(t) started from a single type-k cell is Vjk(t)=Var(Zj(1)(t)|Z(1)(0)=ek)=Bjjk(t)+Akj(t)-Akj2(t). It follows from (5) that Aij(t) and Bjki(t), i,j,k∈K, satisfy the integral equations6 Akj(t)=∑ℓ=1Kmkℓ∫0tAℓj(t-u)dGk(u)+δkj(1-Gk(t)),

and7 Bijk(t)=∑ℓ=1Kmkℓ∫0tBijℓ(t-u)dGk(u)+∑k1=1K∑k2=1Kβk1k2k∫0tAk1i(t-u)Ak2j(t-u)dGk(u).

Let Gk∗(s)=∫0∞e-sxdGk(x) denote the Laplace transform of Gk(·), k∈K, and define the matrixM∗(s)=G1∗(s)m11⋯G1∗(s)m1K⋮⋱⋮GK∗(s)mK1⋯GK∗(s)mKK.

If M∗(s) is irreducible, then its Perron-Frobenius root ρ∗(s) always exists, and we can define [see Mode (1971)]:

Definition 1

(Malthusian parameter) The Malthusian parameter α is the solution, assuming it exists, of the equation ρ∗(α)=1 where ρ∗(α) denotes the Perron–Frobenius root of M∗(α) (i.e., ρ∗(α) is the largest eigenvalue of M∗(α)). The Malthusian parameter α always exists in the super- and critical cases; its existence must be verified in the subcritical case. When α exists, we have α<0, =0, or >0 depending on whether the process is subcritical, critical, or supercritical, respectively.

Suppose that M is positive regular (i.e., ∃n∈{1,2…} such that the entries of Mn are all strictly positive), and the p.d.f. gk(t)=dGk(t)/dt, k∈K, are squared integrable. Let u=(uk,k∈K) and v=(vk,k∈K) denote strictly positive right and left eigenvectors of M∗(α) associated with its Perron–Frobenius root and chosen so that u1⊤=uv⊤=1 where 1=(1,⋯,1). Then, the average intra-clonal composition, normalized by eαt, stabilizes over time: e-αtA(t)→C, as t→∞, for some fixed matrix C=(cjk,j,k∈K) (Mode 1971). When K>1 (finite), this result remains valid under mild assumptions. When K=∞, it may still hold depending on the offspring and lifespan distributions.

Let W(t)=e-αtZ(t). We may assume that (A4) In the supercritical case (α>0), W(t)⟶a.s.Wv as t→∞ for some r.v. W such that W=0 (or >0) a.s. if limt→∞Z(t)=0 (or ≠0).

Remark 3

For single-type Bellman–Harris processes, specific conditions under which Assumption (A4) holds are given in Harris (1963) (Ch. VI, Theorem 21.1 and Corollary). For multitype Markov branching processes, see Athreya and Ney (1972) (Ch. V, Sect. 7.5, Theorem 2). For multitype age-dependent branching processes, see Mode (1971) (Sect. 3.13, Theorem 13.1). Also, convergence may hold in probability or in mean square instead of almost surely.

Remark 4

Intra-clonal dynamics is affected by whether the clonal family ultimately survives. Assuming (A4) holds, and letting q=P{W=0} denote the probability of extinction, we have conditional on non-extinction that8 Pe-αtZ(t)≤x|Z(t)>0⟶t→∞1-1-P{Wv≤x}1-q.

Otherwise, the process converges to 0 as t→∞ (extinction).

To describe the dynamics of GC B cells, define the vector Y(t)=Yk(t),k∈K, t≥0, where Yk(t) denotes the number of type-k B cells at time t in the GC. We assume that the GC does not contain any B cell at time t=0, and set Y(0)=0 where 0 denotes the K-dimensional null vector. Define Y(t):=∑k=1KYk(t). For every t≥0, Y(t) can be expressed as9 Y(t)=∑ℓ=1Π(t)Z(ℓ)(t-Tℓ)1{Π(t)>0},

where Z(ℓ)(u)=(Zk(ℓ)(u))k∈K represents the composition of the ℓ-th clone u units of time after it started, setting Z(ℓ)(u)=0, u<0. We refer to Y(·) as a K-type age-dependent branching process with non-homogeneous immigration.

Let Φ(t;s)=E{sY(t)|Y(0)=0} denote its p.g.f., M(t)=(Mi(t))i∈K and C(t)=(Cij(t))i,j∈K where Mi(t)=E(Yi(t)|Y(0)=0) and Cij(t)=Cov(Yi(t),Yj(t)|Y(0)=0) denote the expectation and covariance of Y(t). Adapting a result from Mitov et al. (2018), we deduce when Assumptions (A1,A2) hold that10 Φ(t;s)=exp-∫0tr(t-x)1-∑i∈KgiFi(x;s)dx,

with the boundary condition Φ(0;s)=1. Moreover, for every j,k∈K,11 Mj(t)=∫0tr(t-x)A¯j(x)dxandCjk(t)=∫0tr(t-x)C¯jk(x)dx,

where A¯j(x)=∑i∈KgiAij(x) and C¯jk(x)=∑i∈KgiBjki(x).

Classes of B cells that communicate do not vanish

Under Assumption (A4), the proportion of type-k cells in a clonal family not going extinct tends a.s. to vk/∑k′=1Kvk′ as t→∞. Since v has strictly positive entries, all types are predicted to grow at the same exponential rate α, regardless of the probability at which they die or self-renew. This property arises from the irreducibility of the mean offspring matrix M (i.e., the fact that all types communicate). It is illustrated in Fig. 6 using simulations based on a two-type process. From a biological standpoint, communication between types is driven by somatic hypermutation. Its biological interpretation in the context of Model 1 (Sect. 3.5.1) is that clonal families in which high binding affinity B cells can mutate into lower binding affinity B cells (and vice versa) may include non-negligible numbers of B cells of varying binding affinity levels, even those less likely to survive. Kuraoka et al. (2016) made a similar observation in mouse experiments, reporting clonally related B cells competing for a same epitope but with affinity orders of magnitude different (Kuraoka et al. 2016). They observed cases where low-affinity B cells accounted for 22–27% of GC B cells. This observation, which has been interpreted as an indication of the permissiveness of GC to retain low or moderate affinity B cells (Kuraoka et al. 2016; Bannard and Cyster 2017), is not fully understood. While several factors could explain it, including the possibility of an affinity threshold (Kuraoka et al. 2016), the asymptotic behavior of Z(t) indicates that clonal expansion and somatic hypermutation could also jointly contribute.Fig. 6 Behavior of a two-type process, with and without immigration. Panels A1-A4 show results from 10 independent simulations of the model without immigration, with (m11,m12,m21,m22)=(0.20,0.50,0.55,0.20) and G(·) assumed exponential with parameter λ=1/24. Each trajectory represents the evolution of one clone. Each of them begins with one type-2 (∼ high binding affinity) cell. Panel A1 (resp., A2): number of low (resp., high) binding affinity B cells per clone over time; Panel A3: count of high versus low binding affinity B cells which grow at the same rate; Panel A4: ratio of the numbers of low and high binding affinity B cells plotted over time; the black straight line indicates its a.s. limit ≃0.37. Panels B1-B4 are identical to panels A1-A4, except that simulations were conducted by setting (m11,m12,m21,m22)=(0,0.30,0.55,0.20). The a.s. limit is ≃0.31 in this setting. Panels C1-C4 are similar to those above, but the model now includes immigration. The parameters of the branching process were identical to those used for panels B1-B4; the immigration Poisson process was time-homogeneous and assumed that g1=g2=0.5 and r0=0.25

On selection and competition between B cells

Several processes contribute to the regulation of B cells in GC. Homeostasis maintains a balance between B-cell amplification and excessive immune activation. Additionally, antigen-mediated selection favors B cells that have undergone mutations that result in higher affinity for the antigen. These selected B cells receive stronger survival signals compared to those with lower affinity, which are more prone to undergoing apoptosis.

The model accounts for some, but not all, of these processes. For instance, it captures, at least partially, variations in antigen-mediated selection among B cells by introducing type-specific probabilities of cell death (pk0). These probabilities can differ, resulting in some cell types in the model having lower fitness and being more susceptible to cell death than others.

However, the model does not consider the homeostatic mechanisms that regulate the growth of GC B-cell populations. Specifically, in cases where a clonal family is driven by a supercritical process that does not go extinct, its size will grow exponentially. Therefore, when describing the composition of a population based on cell counts, the model is best suited for depicting the organization of GC or individual clonal families during their early phase. Over extended time periods, the model can be used to track the temporal evolution of the relative frequencies of B cell classes using Y(t)/Y(t) or Z(t)/Z(t).

Another critical aspect of GC dynamics involves the competition among B cells, both between and within clonal families and types. When a new B cell with higher affinity than those already present in the GC joins the population, competition could increase the likelihood of death of other, less competitive cell types, resulting in a reduction of their Malthusian parameter. While the model does not explicitly detail this phenomenon, it partially captures it when comparing the growth of two distinct cell types. To illustrate, consider two different, non-communicating cell types k≠k′. Assume that each of them satisfies Assumption (A4) such that Zk(t-Tk)∼vkWkeαk(t-Tk) and Zk′(t-Tk′)∼vk′Wk′eαk′(t-Tk′). The ratio Zk(t)/Zk′(t), representing the odds of selecting a cell of type k versus type k′, provides insights into how the frequencies of cell types k and k′ evolve over time. We use it in Sect. 5 to compare the size of clonal families. For every t≥max(Tk,Tk′), conditional on non-extinction for both clonal families (WkWk′>0), this ratio satisfies:Zk(t-Tk)Zk′(t-Tk′)∼a.s.Wkvke-αkTkWk′vk′e-αk′Tk′e(αk-αk′)t(ast→∞).

Thus, the odds would remain similar to those in a model where the Malthusian parameter in the k-th clone decreases upon the initiation of the more competitive k′-th clonal family, provided that the difference between the Malthusian parameters is αk′-αk. Overall, despite some limitations, we have observed that the model can effectively replicate certain experimental observations.

Temporal diversity of the B-cell repertoire

A diverse BCR repertoire is essential for effective immune protection against infection and a potential benefit for responses to antigens structurally related to those from past infections or vaccinations (Kuraoka et al. 2016). However, it can also give rise to significant amounts of B cells expressing binding antibodies unlikely to progress toward pathogen neutralization; instead, these B cells may compete with and restrict those capable of generating neutralizing antibodies. We propose to measure evolution of diversity over time in terms of the K types of the model to gain further insights into the organization of the B-cell repertoire. In this regard, we introduce indices of temporal α and β diversities for multitype branching processes. We applied them in Sect. 5 to study the turnover of clonal families within GC.

Temporal alpha diversity

Alpha diversity is a fundamental concept in ecology to quantify species diversity within a given habitat. Popular alpha diversity indices include the Hill numbers. When applied to the proposed multitype branching process with immigration to quantify the diversity of types in a GC at time t, the Hill number of order q, defined on the event {Y(t)=∑k=1KYk(t)>0}, is given by12 DYq(t)=∑k=1KYk(t)qY(t)q1/(1-q)∈[1,K1/(1-q)],

where q∈(0,1)∪(1,∞) determines the sensitivity of the index to the relative frequency of each type, with the influence of the most abundant types increasing with q (Hill 1973). The higher DYq(t), the higher diversity. Letting q→0, DYq(t) tends to DY0(t)=∑k=1K1{Yk(t)>0} (species richness), representing the total number of types in the GC at time t. Setting q=2 yields the inverse Simpson diversity index (Simpson 1949) used in Sect. 5 to assess evolution of clonal diversity, whereas letting q→1 gives the exponential of the Shannon index:13 DY1(t):=exp-∑k=1KYk(t)Y(t)logYk(t)Y(t)∈[1,K].

Clone-specific Hill numbers are defined on {Z(t)=‖Z(t)‖>0} as DZq(t)=∑k=1KZk(t)qZ(t)q1/(1-q). Since the summands in DYq(t) and DZq(t) are positive, both DYq(t) and DZq(t) are well defined when K=∞.

Proposition 1

Suppose that Assumption (A4) holds. Then, conditional on non-extinction (W>0), we have for every K∈{1,2…} that limt→∞DZq(t)=a.s.∑k=1Kvkq/(∑k′=1Kvk′)q1/(1-q) for every q∈(0,1)∪(1,∞), limt→∞DZq(t)=a.s.K as q→0, and limt→∞DZ1(t)=a.s.exp-∑k=1Kvk∑k=1Kvklogvk∑k=1Kvk as q→1.

The proof follows easily from Assumption (A4) and Proposition 1 in Hill (1973).

Temporal beta diversity

The variation in species composition between two habitats or time points may be measured using beta diversity indices (Whittaker 1960, 1972). We consider these indices to quantify the degree of temporal dissimilarity (turnover) of the K types in a clonal family and a GC. These indices are defined using either presence-absence, or abundances (counts), or relative abundances (proportions) of types. The Jaccard distance (Jaccard 1912) between the collection of types present in a clonal family at times t1 and t2 is defined using absence-presence of types as14 JZ(t1,t2)=1-|S(t1)∩S(t2)||S(t1)∪S(t2)|∈[0,1],

where S(t)={k∈K:Zk(t)>0} is the set of types in the clone at time t. A value of 0 indicates identical type representation at times t1 and t2, and 1 no overlap in types. This index does not take frequency of types into account in measuring diversity. The Bray–Curtis index, which quantifies the degree of compositional dissimilarity within a clonal family at times t1 and t2 using15 BCZ(t1,t2)=∑k=1K|Zk(t1)-Zk(t2)|Z(t1)+Z(t2)∈[0,1],

is defined based on the vector of counts Z(t) and normalized by Z(t1)+Z(t2) to range between 0 (no compositional variation) and 1 (full turnover of types). A popular beta diversity index based on relative abundances to measure the overlap between the composition of a clonal family at times t1 and t2 is the Hellinger distance HZ(t1,t2)=1-BZ(t1,t2) where16 BZ(t1,t2)=∑k=1KZk(t1)Z(t1)Zk(t2)Z(t2)∈[0,1]

is the Bhattacharyya coefficient, representing the cosine of the angle between the vectors Z(t1)/Z(t1) and Z(t2)/Z(t2) (Bhattacharyya 1946). Another similar index also based on the relative abundances Z(t)/Z(t) is the proportion of similarity (Whittaker 1972):17 PZ(t1,t2)=∑k=1KminZk(t1)Z(t1),Zk(t2)Z(t2)=1-12∑k=1KZk(t1)Z(t1)-Zk(t2)Z(t2).

Both BZ(t1,t2) and PZ(t1,t2) range between 0 (no compositional similarity between t1 and t2) and 1 (perfect similarity). The Hellinger distance HZ(t1,t2) also ranges between 0 (absence of change in the proportion of types from t1 to t2) and 1 (complete turnover of types). These indices are all defined conditional on Z(max(t1,t2))>0. They emphasize different aspects of the composition of a clonal family. For multitype branching processes, they behave as follows:

Proposition 2

Let K∈{1,2…}∪{∞}, δ≥0, and suppose that Assumption (A4) holds. Then, conditional on {W>0}, we have as t→∞ that JZ(t,t+δ)⟶a.s.0,BCZ(t,t+δ)⟶a.s.bcZ(δ,α):=1-e-αδ1+e-αδ∼1-e-αδasαδ→∞,

whereas HZ(t,t+δ)⟶a.s.0, BZ(t,t+δ)⟶a.s.1, and PZ(t,t+δ)⟶a.s.1, for every δ>0.

See Sect. 7.1 for a proof. Proposition 2 shows that the Bray–Curtis index of the compositional beta diversity of a clonal family not becoming extinct converges over time to a finite constant in the admissible range [0, 1], depending on δ. Convergence to 1 as δ→∞ occurs exponentially fast with δ and reflects the continual expansion of the clonal family as δ increases. Interestingly, asides from δ, the limit in t depends solely on α. Thus, as t→∞, the Bray–Curtis index becomes insensitive to any aspect of the offspring and lifespan distributions beyond those captured by the Malthusian parameter, and to the number of types, K. It partitions the family of supercritical multitype branching processes into equivalence classes indexed by α and including processes with identical Bray–Curtis diversity. Hence, two non-extinct multitype branching populations with identical Bray–Curtis indices have similar Malthusian parameter α, whereas when their Bray–Curtis indices differ, the one with the highest index is expected to have a larger Malthusian parameter because bcZ(δ,α) increases with α. It follows easily from Proposition 2 thatα^Z(t,δ)=1δlog1+BCZ(t,t+δ)1-BCZ(t,t+δ)⟶a.s.αast→∞

for every δ≥0 if Assumption (A4) holds and conditional on non-extinction.

The indices HZ(t,t+δ), BZ(t,t+δ), and PZ(t,t+δ) tend to 0 or 1 as t→0 regardless of δ. The behavior of these indices reflects intra-clonal stabilization of the frequency of the types as t increases. See (Jagers and Nerman 1996) for further discussion on the asymptotic composition of supercritical multitype branching processes.

Indices of beta diversity may also be defined at the GC level; for example,18 BCY(t1,t2)=∑k=1K|Yk(t1)-Yk(t2)|Y(t1)+Y(t2),BY(t1,t2)=∑k=1KYk(t1)Y(t1)Yk(t2)Y(t2),

and HY(t1,t2)=1-BY(t1,t2). The asymptotic behavior of GC-specific indices must be treated on a case-by-case basis. For the model studied in Sect. 5, HY(t,t+δ) converges a.s. to 0 as δ→∞ when the branching mechanism is the same across clonal families.

Oligoclonality, diversity of clonal families, and instability of clonal dominance

Background and notation

Germinal center reactions begin polyclonal and tend to finish oligoclonal (Kroese et al. 1987; Küppers et al. 1993; Faro and Or-Guil 2013; Tas et al. 2016). The cross-sectional experiments that established these findings did not capture the temporal trajectory of individual clones. Thus, for example, we do not know whether clones that dominate a GC remain dominant over time.

To gain further insights into the dynamics of clonal dominance, we consider the infinite-type process introduced in Sect. 3.5.2 and formulate the overall immigration process Π(·) as a time-inhomogeneous Poisson process with rate r(·). The order of arrival induced by this process determines the types in the model. Since each type represents a specific clone, the sequence {Tkℓ}k=1∞ a.s. satisfies Tk1=Tk and Tkℓ=∞, ℓ=2,3…. The first identity indicates that the time at which the first member of the k-th clone joins the GC (Tk) is the time at which the first type-k founder B cell joins the GC. The second identity ensures that each clone has a unique arrival time in the GC. Consequently, the type-specific immigration processes {Πk(·)}k=1∞ are neither Poisson processes nor independent. The composition of the k-th clone at time t is Z(k)(t)=(0,⋯,0,Zk(k)(t),0,⋯); hence, Y(t)=(Z1(1)(t-T1),Z2(2)(t-T2),⋯) from (9).

For every k∈K={1,2…}, the lifespan of every type-k B cell in the GC is a r.v. with c.d.f. Gk(·), and their probability of division is p2k. Since binding affinity may differ between clones, we assume that these probabilities are independent and identically distributed (i.i.d.) r.v. with c.d.f. H(x)=P{p2k≤x}, x∈[0,1]. Likewise, the c.d.f. Gk(·) could be assumed to be randomly sampled from a family of distribution functions. Here, none of the types communicate and, conditional on {p2k,Gk(·)}, we define the Malthusian parameter of the k-th clone as the root αk of the equation19 2p2k∫0∞e-αkxdGk(x)=1,

assuming such a root exists a.s.; it always does when p2k≥0.5. When each Gk(·) is an exponential distribution with parameter λ, the Malthusian parameters are given by αk=(2p2k-1)λ and form a sequence of i.i.d. r.v. with c.d.f.20 P{αk≤u}=P{p2k≤(1+u/λ)/2}=Hλ+u2λ(u∈(-λ,λ)).

The conditional probability of extinction of the k-th clone, given {p2k,Gk(·)}, defined as the smallest non-negative root of the equation fk(s)=s where fk(s)=1-p2k+p2ks2, is pextk=min{1,p2k/(1-p2k)}. If Assumption (A4) holds for the k-th clone, it follows that Zk(k)(t)=a.s.ck′Wkeαkt(1+o(1)) where ck′=(mk-1)/αkmk2∫0∞ue-αudGk(u) and mk=2pk2 (Athreya and Ney 1972).

Definition 2

(Clonal dominance) We say that the k-th clone dominates the GC reaction at time t if its size is equal to or exceeds that of any other clone at time t; that is, if Zk(k)(t-Tk)≥Z′(k′)(t-Tk′), k′∈{1,…,Π(t)}\{k}.

We study temporal evolution of clonal dominance using Fk(t)=Zk(k)(t-Tk)/Y(t), the fraction of B cells in the GC at time t belonging to the k-th clone. We set Fk(t)=0 when Y(t)=0. We study evolution of the alpha and beta diversities of clonal families within GC using indices introduced in Sect. 4. Following initiation of a GC, species (clonal) richness is given byDY0(t)=∑k=1Π(t)1{Zk(k)(t-Tk)>0}∈[0,Π(t)](t≥0).

Assuming independence of Π(t) and {Zk(k)(t-Tk)}k=1∞, the expected count of clonal families satisfies E(DY0(t))∈[(1-Q)R(t),R(t)] where Q=limt→∞P{Z1(1)(t)=0}. Species richness does not account for the abundance of non-extinct clonal families and grows indefinitely with t when Q>0. In particular, when r(t)=r0, t≥0, it can be shown that E(DY0(t))∼r0(1-Q)t, such that increasing in the probability of extinction of clonal families (and of cell death) will proportionally reduce the number of clonal families in the GC. The Simpson index (Simpson 1949) which accounts for the abundance of clonal families and specializes to21 SY(t):=∑k=1Π(t)Zk(k)(t-Tk)2Y(t)2=∑k=1Π(t)Fk(t)2∈[0,1],

is the probability that two cells sampled with replacement at time t from a given GC belong to a same clonal family. The inverse of the Simpson index DY2(t)=SY(t)-1 provides a measure of the alpha clonal diversity: the higher S(t)-1, the larger the clonal diversity, accounting for evenness (Rempala and Seweryn 2013). The Bray–Curtis index and proportion of similarity comparing clonal composition in a GC at times t1 and t2 (t1≥t2) are BCY(t1,t2)=∑k=1Π(t2)|Zk(k)(t1-Tk)-Zk(k)(t2-Tk)|Y(t1)+Y(t2) and PY(t1,t2)=1-12∑k=1Π(t2)|Zk(k)(t1-Tk)Y(t1)-Zk(k)(t2-Tk)Y(t2)|. The Bhattacharyya coefficient is BY(t1,t2)=∑k=1Π(t2)Fk(t1)Fk(t2). Here, we ask what these indices reveal about clonal dynamics in the absence and presence of differential fitness between clones, as previously considered (Tas et al. 2016). We note that the clone-specific diversity indices are DZ2(t)=0, SZ(t)=1, and BZ(t,t+δ)=0 for every t,δ≥0, because each clone includes a single type.

Clonal dynamics in the absence of differential fitness

In this section, we assume absence of differential fitness between clones.

Proposition 3

Suppose that all clones have identical offspring and lifespan distributions. Let α denote their common Malthusian parameter. Suppose that α>0, Assumption (A4) holds, and (A5) there exists a positive, increasing function f(·) such that f(t)=o(t) and limt→∞R(t-f(t))/R(t)=1. Then, for every δ≥0, as t→∞, Fk(t)⟶a.s.Wke-αTk/∑k′=1∞Wk′e-αTk′, k=1,2…, SY(t)⟶a.s.∑k=1∞Wk2e-2αTk/(∑k′=1∞Wk′e-αTk′)2∈(0,1), JY(t,t+δ)⟶P0,BCY(t,t+δ)⟶a.s.(1-e-αδ)/(1+e-αδ),HY(t,t+δ)⟶a.s.0, BY(t,t+δ)⟶a.s.1, and PY(t,t+δ)⟶a.s.1.

See Sect. 7.2 for a proof. Proposition 3 shows that, in the absence of differential fitness between clones, clonal dominance is a stable property unlikely to be challenged by other clones once established. Since the relative abundance Fk(t) is asymptotically proportional to e-αTk⟶a.s.0 (k→∞) and {Wk}k=1∞ is an i.i.d. sequence, clones that arrive early in the GC are the most likely to become dominant. The relative size of the dominant clone tends to increase with α and decrease with the immigration rate (causing Tk-Tk-1 to stochastically decrease). Although the smaller α, the longer it may take for clonal dominance to establish, the replacement of a dominant clone by another clone joining the reaction later is unlikely to happen because this would require a sequence of independent r.v. with a decreasing trend to break a record value that increases with k: suppose the k∗-th clone is dominant and Wk∗>0; then, informally, in order for the k-th clone (k>k∗) to become dominant, we must have logWk-logWk∗⪆α(Tk-Tk∗)≃R(Tk)-R(Tk∗); in particular, if the immigration process is time-homogeneous, the increment between logWk∗ and logWk must grow linearly with k-k∗, requiring the distribution of logWk (given Wk>0) to be heavy tailed, which is not possible since Wk has finite moments (Harris 1963). Convergence of Simpson’s index to a strictly positive r.v. reflects stabilization of the composition of GC in terms of clonal families and that the established order and composition are GC-specific. Also, limt→∞SY(t)<1 shows that GC do not converge toward monoclonality. The higher α, the higher SY(t) (i.e., the more concentrated the distribution of clone size). Convergence of the Bray–Curtis index to the same limit as for Z(·) established in Proposition 2 arises from the fact that all clones obey the same offspring and lifetime distributions. Convergence of other beta diversity indices (to 0 or 1) captures absence of detectable temporal variation in clonal dominance.

Differential fitness induces unstable clonal dominance

We now assume that {αk}k=1∞ is a sequence of non-degenerate r.v., and show that any dominant clone is eventually outcompeted.

Proposition 4

Suppose that Assumption (A4) holds, limt→∞R(t)=∞, P{α1>0}>0, H+(x)=P{α1≤x|α1>0}, x≥0, is absolutely continuous, and ∫0∞gk(x)δdx<∞ for some δ>1, k=1,2…. Then, as t→∞, (i) Fk(t)⟶a.s.0, and (ii) ∃k′∈{k+1,k+2⋯} a.s. such that Fk(t)/Fk′(t)⟶a.s.0.

See Sect. 7.3 for a proof. Proposition 4 states that (i) the relative size of every clone within a GC becomes eventually negligible and (ii) every dominant clone is eventually outcompeted with probability one and regularly replaced as long as the GC reaction continues: an average of at least 3 weeks in lymph nodes and spleens, and much longer in Peyer’s patches. The replacement of dominant clones contributes to the diversification of the BCR repertoire by allowing new clones to expand over time. Informally, the replacement of a dominant clone occurs primarily when a new clone that joins the GC is not on a path to extinction and has a Malthusian parameter higher than that of the dominant clone. The phenomenon is also driven by a record process; however, unlike the one describes in Sect. 5.2, here the record process associates with the Malthusian sequence: α(t)=max{αk,k∈{1⋯,Π(t)}:Wk>0}, t≥0. Let L(t) denote the number of such record values between times 0 and t. Since the number of clones joining the GC between the L(t)-th and (L(t)+1)-th records tends to increase exponentially with L(t) (Neuts 1967), the rate of clonal turnover should rapidly slow down with L(t), unless, for instance, the Malthusian parameters of founder B cells visiting the GC increase stochastically over time. This scenario could potentially occur if the GC was to recruit B cells released by other concurrent GC, exhibiting a high affinity for any of the antigens driving the reaction.Fig. 7 Temporal evolution of clonal dominance and clonal diversity. Top: Evolution of the absolute and relative size of individual clonal families (i.e., Zk(k)(t) and Fk(t)) within a GC (each line represents one clonal family). Bottom: Evolution of clonal diversity within the GC, as measured by the Inverse Simpson index, in three scenarios corresponding to r(t)=r0t-1/2 (left), r(t)=r0 (center), and r(t)=r0t1/2 (right), with r0=10 in all three cases. See Sect. 5.2 for detail

Simulations: impact of the shape of immigration

We assumed that every Gk(·) is an exponential distribution with mean 1 so each unit of time represented the average duration of one mitotic cycle. For reference, the mean mitotic cycle of activated B cells has been estimated to last 8–10 h (Chan et al. 2021). We also assumed that p0k was uniformly distributed in the interval [0.35, 1]. Thus, each process Zk(k)(·) was super-critical with probability 0.23 (=0.15/0.65). We were interested in studying the impact of the shape of the immigration rate on the dynamics of clonal families, considering three scenarios with different immigration rates: (1) r(t)=r0t-1/2, where immigration intensity decreases at a rate of -1/2 as discussed in Sect. 3.3; (2) r(t)=r0, with a constant rate over time; and (3) r(t)=r0t1/2, where immigration intensity increases at a rate of γ=1/2. The immigration r(t) has not yet been estimated based on experimental data. However, in the stationary case, it seems reasonable to assume that it is at least one order of magnitude faster than the mean mitotic cycle duration. Consequently, we set r0=10 in all three cases. For computational reasons, we simulated the process over 20 units of time. Assuming that mitotic cycles and GC reactions last on average 10 h and 3 weeks, respectively, a duration of 20 units of time would cover almost half of the lifespan of a GC. We simulated the process 10 times in each scenario to identify patterns in the temporal trajectories of the Simpson index.

Results from the simulations are presented in Fig. 7. The top two panels show the evolution of the absolute and relative size of individual clonal families. Over the 20 time units, three clonal families reached clonal dominance (right panel). The bottom three panels indicate that clonal diversity, as measured by the Simpson diversity index, increases initially before leveling off between 5 and 10 units of time after initiation of the reaction. This pattern holds in the three immigration scenarios. In scenario (1) where the immigration rate decreases, the Simpson index tends to gradually decrease thereafter, suggesting that clonal diversity consistently reduces as the influx of founder B cells slows down. In the other two scenarios, diversity appears to also decrease but at a slower rate or less consistently among simulations. These results illustrate the potential benefit in sustaining the influx of B cells into GC in order to increase clonal diversity.

Biological relevance

Recent studies estimated that around a few hundreds of founder B cells colonize GC, clearing the field from a commonly held belief that GC are seeded by 2–10 B cells (Faro and Or-Guil 2013; Tas et al. 2016; Kroese et al. 1987). Our model leads to a similar conclusion and supports the hypothesis that oligoclonality results from differential binding affinity between clones. We note that past studies were based on cross-sectional data. They could not track the number of clones accumulated in GC over their entire lifespan and may not have accounted for those that were outcompeted and eliminated before the GC were observed and for clones that had not yet joined the GC. Therefore, reported estimates may represent lower bounds for the number of founder B cells that join GC, and their actual number could be larger. Proposition 4 also suggests that clones with the highest binding affinity will tend to arrive late in GC, such that clonal dominance at a particular time point need not reflect optimal binding affinity.

Convergent evolution within BCR repertoires

Steering the repertoire via sequential immunization

Antibodies play a key role in protective immunity against various pathogens. Although only a handful of people are known to have been cured from HIV thus far, numerous studies have demonstrated that the bnAbs that emerge in a significant proportion of individuals with HIV infection can neutralize a wide array of circulating viral strains by targeting conserved HIV epitopes, the specific sites on the antigen that these bnAbs bind to, marking a promising avenue for potential therapeutic interventions. Particularly, a successful vaccine regimen might be designed by recapitulating the process giving rise to bnAbs via a sequence of strategically designed prime-boost immunogens that can trigger the activation of B cells with the molecular and genetic traits of targeted bnAbs and guide a subset of the B-cell repertoire toward neutralization against HIV by selecting appropriate somatic hypermutations. Figure 1 provides an illustration of the principle of this strategy assuming two boosts; a successful vaccine might require a larger number of boosts.

Two obstacles to the elicitation of bnAbs through vaccination are the exceptionally high mutation frequency characteristic of HIV bnAb which vaccines may have to induce and the difficulty of the germline precursors of HIV bnAbs to bind with the envelopes of circulating viral strains. In addition, some mutations necessary for neutralization may be rare, and the process of somatic hypermutation can either lead to mutations at positions where the bnAbs align with the germline or erase previously acquired mutations conducive to bnAb development. Neither of these outcomes may be desirable as they can impede or prevent maturation towards neutralization.

To quantify the process of steering BCR towards bnAbs, we introduce a model that describes the accumulation of somatic hypermutations in BCR relative to their germline and the targeted bnAb. To fix ideas, our model focuses on the region encoded by the V gene, also known as the V segment.

Foreword to the modeling approach

In HIV vaccine research, evolution of the B-cell repertoire may be assessed by sequencing the heavy and light chains of thousands of antigen-specific B cells and comparing the mutations accumulated in their Ig gene loci with those found in relevant bnAbs. Multiple metrics may be designed to quantify this evolution in individual BCR sequences, depending in part on the class of B cells that the vaccine is expected to induce. Here, we opt for a simple, generic metric that enumerates mutations in five distinct regions of the heavy chain V segment. These regions are defined by whether mutations occur at positions where the aligned bnAb and germline gene sequences match or do not match. The proposed metric can be restricted to specific positions of the V segment without altering the model structure and interpretation.

Acknowledging the intricate nature of somatic hypermutation and antigen-mediated selection, we adopt a high-level modeling approach: instead of detailing BCR maturation on a per-position and per-nucleotide basis, we focus on counting the number of amino acid substitutions within the five identified regions. On one hand, aggregating multiple positions and nucleotide substitutions obscures the ability to specify how the accumulation of mutations alters antigen-mediated selection or the fitness of B cells. On the other hand, aggregation is expected to average out the impact of mutations on selection of B cells by the vaccine, at the level at which assumptions are postulated.

Our model offers a useful framework to understand some aspects of the evolution of the BCR repertoire. We use it in Sect. 6.7 to interpret BCR sequencing data. The analysis underscores the potential challenges in precisely replicating a particular antibody. Regardless, achieving neutralization through vaccination might not necessarily require reproducing a specific bnAb, as other unidentified antibodies could also induce broad neutralization.

Partitioning the V segment into 5 classes of positions

Let B=(B1,⋯,BL) and G=(G1,⋯,GL) denote the amino acid sequence of the V segment of a given targeted antibody and its germline V gene. To fix ideas, suppose that the antibody is VRC01; its heavy chain is encoded by the VH1-2*02 allele (Fig. 8). Let V denote the set of amino acid positions of the bnAb V segment. This set may be partitioned into two subsets: the positions at which the germline and bnAb amino acids are identical and those at which they differ. We respectively denote these two subsets by V1 and V2; they satisfy V1∪V2=V and V1∩V2=∅. Let L=|V| denote the length of the V segment, and put La=|Va|, a=1,2. For VRC01, L=98, L1=57, and L2=41.

Now, let S=(S1,⋯,SL′) denote the amino acid sequence of any BCR, to be compared against both its germline V gene and the bnAb. Let V11(S)={p∈V1:Sp=Gp} denote the set of positions within V1 at which S matches the germline and the bnAb. Define also V12(S)={p∈V1:Sp≠Gp}=V1\V11(S), V21(S)={p∈V2:Sp=Gp}, V22(S)={p∈V2:Sp=Bp}, and V23(S)={p∈V2:Sp≠Gp,Sp≠Bp}=V2\(V21(S)∪V22(S)). The mutations accumulated in S that moved the BCR away from the bnAb are identified by V12(S), those shared with the bnAb belong to V22(S), whereas those that moved the BCR sequence S away from the germline V gene without changing its Hamming distance to the bnAb are in V23(S). See Fig. 8 for an illustrative example. Mutations may change the size of the subsets Vab(S); however, by construction, the subsets V2b(S), b=1,2,3 are invariant to mutations in V1; likewise, mutations in V2 do not change the subsets V11(S) and V12(S).

Define L(S)=(L11(S),L12(S),L21(S),L22(S),L23(S)) where Lab(S)=|Vab(S)| is the size (number of positions) in Vab(S), (a,b)∈{(1,1),(1,2), (2,1),(2,2),(2,3)}. The total number of mutations in S is N(S)=L12(S)+L22(S)+L23(S). A successful sequential immunization regimen might elicit BCR getting closer to targeted bnAbs as they accumulate mutations. A simple measure of the immune response toward this goal is the net mutational gain/loss relative to a bnAb, defined as Δ(S)=L22(S)-L12(S), with a positive value indicating overall progression of the sequence toward the target antibody. The dynamic model formulated in the next three sections describes the evolution of L(S) when S is sampled from a tree generated by a multitype branching process.

The mutational model, absent of cell kinetics

Let S(0)=(S1(0),⋯,SL(0)) denote the amino acid sequence of the V segment of the BCR of any B cell at birth. We make the simplifying assumption that the two daughters of a dividing B cell inherit identical Ig gene sequences from their mother at division, represented by S(1)=(S1(1),⋯,SL(1)). Unless a synonymous mutation occurs, the sequences S(0) and S(1) differ at the mutated position. Let π~ denote the probability that mutations occur in the V segment. Allen et al. (1987) estimated that the BCR of one out of every other B cell inherits one mutation from their mother (Allen et al. 1987), such that we may set π~∈(0;0.5) when focusing on the V segment. In what follows, we formulate a mutational model that describes the accumulation of somatic hypermutations in the subsets Vab, assuming at most one mutation happens per cell cycle.

For a=1,2, let πa(0) denote the conditional probability that a mutation occurs in S(0) at one position in Va, given a mutation occurs. Mutations arise according to the following 10 scenarios (cases):L(S(1))=L(S(0))+e1|1:=-11000w.p.π1(0)π1|1(0)Case 1.1e2|1:=1-1000w.p.π1(0)π2|1(0)Case 1.2e3|1:=00000w.p.π1(0)(1-π1|1(0)-π2|1(0))Case 1.3e1|2:=00-110w.p.π2(0)π1|2(0)Case 2.1e2|2:=00-101w.p.π2(0)π2|2(0)Case 2.2e3|2:=001-10w.p.π2(0)π3|2(0)Case 2.3e4|2:=000-11w.p.π2(0)π4|2(0)Case 2.4e5|2:=0010-1w.p.π2(0)π5|2(0)Case 2.5e6|2:=0001-1w.p.π2(0)π6|2(0)Case 2.6e7|2:=00000w.p.π2(0)(1-∑i=16πi|2(0))Case 2.7

where πi|a(0) denotes the conditional probability that a mutation occurs in S(0) according to Case a.i, given that a mutation occurs in Va. They reflect the impact of somatic hypermutation, accounting for both synonymous and non-synonymous mutations. Put π3|1(0)=1-∑i=12πi|2(0) and π7|2(0)=1-∑i=16πi|2(0).

In Case 1.1, a non-synonymous mutation in V11(S(0)) moves the BCR further from the germline and bnAb. The mutation causes a one-position decrease in the size of V11(S(0)) and a one-position increase in that of V12(S(0)), as indicated by the increment e1|1=(-1,1,0,0,0). In Case 1.2, a non-synonymous mutation in V12(S(0)) reverts a prior mutation back to the germline amino acid; hence, the change of e2|1=(1,-1,0,0,0). In Case 1.3, a mutation occurs in V1 without altering either V11(S(0)) or V12(S(0)). Hence, the absence of any difference between S(0) and S(1) indicated by e3|1=(0,0,0,0,0). Such mutations include synonymous mutation occurring in V11(S(0)) and any mutations occurring in V12(S(0)) that do not revert to the germline/bnAb amino acid.

In Case 2.1, a non-synonymous mutation in V21(S(0)) matches the bnAb amino acid at the mutating position, bringing the BCR one amino acid closer to the bnAb. In Case 2.2, a non-synonymous mutation also in V21(S(0)) does not match the bnAb amino acid at the mutating position and grows V23(S(0)) by one position. In Case 2.3, a non-synonymous mutation in V22(S(0)) reverts the BCR to the germline amino acid. In Case 2.4, a non-synonymous mutation occurs in V22(S(0)) which does not match the germline amino acid. In Case 2.5, a non-synonymous mutation in V23(S(0)) reverts the BCR back to the germline amino acid. In Case 2.6, a non-synonymous mutation also in V23(S(0)) matches the bnAb amino acid. In Case 2.7, a mutation, possibly synonymous, in V2 matches neither the germline nor the bnAb amino acid, leaving the subsets V21(S(0)), V22(S(0)), and V23(S(0)) unchanged. We note that mutations within V21(S(0)) and V22(S(0)) must necessarily be synonymous, whereas those within V23(S(0)) can be either synonymous or non-synonymous.

A parametrization of the transition probabilities

We present a parametrization of the probabilities πi(0) and πi|a(0) structured around the number of positions in Vab(S(0)) to facilitate their interpretation and selecting their values in simulations. We note that, depending on S(0), not all 10 transitions presented in Sect. 6.4 are possible; for instance, Case 1.1 cannot happen when S1(0)=0. These cases are handled by setting πi|a(0)=0.

The probability of a mutation occurring in V1 compared to V2 may depend on the relative sizes of these two sets, and we write π1(0)=ρ1L1L=1-π2(0) for some constant ρ1∈(0,LL1) which represents the selection bias in favor of (ρ1∈(1,L1/L)) or against (ρ1∈(0,1)) bnAb-like mutations. When ρ1=1, the odds of a mutation occurring in V1 instead of V2 is L1L2 and depends solely on the size of V1 relative to that of V2. Since mutation rates vary across positions along the Ig gene sequences, positions in V1 may collectively have a higher (or lower) probability of mutation than those in V2, and we can adjust ρ1∈(1,LL1) to increase the likelihood of the mutation occurring in V1 relative to V2, and vice versa when ρ1∈(0,1).

To specify the probabilities πi|a(0), it will be convenient to define the events Ma={amutationoccursinVa}, Mab(0)={amutationoccursinVab(S(0))}, and Sab(0)={themutatedsequenceS(1)belongstoVab(S(0))}. Then, for mutations occurring in V1, we have that π1|1(0)=P{M11(0), S12(0)|M1}, π2|1(0)=P{M12(0), S11(0)|M1}, π3|1(0)=π3|1,1(0)+π3|1,2(0) where π3|1,1(0)=P{M11(0),S11(0)|M1} and π3|1,2(0)=P{M12(0),S12(0)|M1}. Similarly, for mutations occurring in V2, we have that π1|2(0)=P{M21(0), S22(0)|M2}, π2|2(0)=P{M21(0), S23(0)|M2}, π3|2(0)=P{M22(0), S21(0)|M2}, π4|2(0)=P{M22(0), S23(0)|M2}, π5|2(0)=P{M23(0), S21(0)|M2}, π6|2(0)=P{M23(0), S22(0)|M2}, and π7|1(0)=π7|1,1(0)+π7|1,2(0)+π7|1,3(0) where π7|2,1(0)=P{M21(0), S21(0)|M2}, π7|2,2(0)=P{M22(0), S22(0)|M2}, and π7|2,3(0)=P{M23(0), S23(0)|M2}.

Following the reasoning used to specify π1(0), we assume thatP{M11(0)|M1}=ρ1|1L11(S(0))L1=1-P{M12(0)|M1},

for some constant ρ1|1∈(0,L1L11(S(0))) modulating the odds of a mutation occurring in V11(S(0)) compared to V12(S(0)), after accounting for the number of positions. The per-position mutation rate is greater in V11(S(0)) than V12(S(0)) when ρ1|1∈(1,L1L11(S(0))), equal when ρ1|1=1, and lower when ρ1|1∈(0,1).

Additionally, we set P{S11(0)|M11(0)}=σ1|1P{S12(0)|M11(0)} where σ1|1 represents the odds of a mutation occurring in V11(S(0)) being synonymous. Most nucleotide substitutions of the third base (wobble position) of every codon induce synonymous mutations, whereas substitutions in the first and second bases induce non-synonymous mutations; hence, we set σ1|1=1/3 as an approximation in simulations. Similarly, we set P{S12(0)|M12(0)}=σ2|1P{S11(0)|M12(0)} where σ2|1 represents the odds of a mutation occurring in V12(S(0)) not reverting to the germline. We deduce that P{S11(0)|M11(0)}=σ1|11+σ1|1 and P{S12(0)|M12(0)}=σ2|11+σ2|1. Therefore, π1|1(0)=ρ1|11+σ1|1L11(S(0))L1, π3|1,1(0)=σ1|1ρ1|11+σ1|1L11(S(0))L1, π2|1(0)=11+σ2|11-ρ1|1L11(S(0))L1, and π3|1,2(0)=σ2|11+σ2|11-ρ1|1L11(S(0))L1.

In order to specify the probability of a mutation occurring in V2, we assume that mutations in V2 target V21(S(0)) with probability π1|2(0)+π2|2(0)+π7|2,1(0)=ρ1|2L21(S(0))L2, where the coefficient ρ1|2 modulates the per position mutation rate within V21(S(0)) relative to V22(S(0))∪V23(S(0)). Likewise, mutations that occur in V2 target V22(S(0)) with probability π3|2(0)+π4|2(0)+π7|2,2(0)=ρ2|2L22(S(0))L2, whereas those that target V23(S(0)) occur with probability π5|2(0)+π6|2(0)+π7|2,3(0)=ρ3|2L23(S(0))L2. Since ρ1|2L21(S(0))L2+ρ2|2L22(S(0))L2+ρ3|2L23(S(0))L2=1, we deduce thatρ3|2=L2L23(S(0))1-ρ1|2L21(S(0))L2-ρ2|2L22(S(0))L21{L23(S(0))>0}.

We next assume that P{S22(0)|M21(0)}=σ12|2P{S21(0)|M21(0)} and P{S23(0)|M21(0)}=σ13|2P{S21(0)|M21(0)}, where the parameters σ12|2 and σ13|2 modulate the odds of a mutation in M21(0) matching the target antibody sequence and matching neither the target antibody nor the germline sequences, respectively, relative to a mutation matching the germline sequence. Since P{S21(0)|M21(0)}+P{S22(0)|M21(0)}+P{S23(0)|M21(0)}=1, it follows that P{S21(0)|M21(0)}=11+σ12|2+σ13|2, P{S22(0)|M21(0)}=σ12|21+σ12|2+σ13|2, and P{S23(0)|M21(0)}=σ13|21+σ12|2+σ13|2.

Similarly, we assume that P{S21(0)|M22(0)}=σ21|2P{S22(0)|M22(0)} and P{S23(0)|M22(0)}=σ23|2P{S22(0)|M22(0)}, where the parameters σ21|2 and σ23|2 modulate the odds of a mutation in M22(0) matching the germline sequence and matching neither the target antibody nor the germline sequences, respectively, relative to a mutation matching the bnAb sequence. Since P{S21(0)|M22(0)}+P{S22(0)|M22(0)}+P{S23(0)|M22(0)}=1, we deduce that P{S21(0)|M22(0)}=σ21|21+σ21|2+σ23|2, P{S22(0)|M22(0)}=11+σ21|2+σ23|2, and P{S23(0)|M22(0)}=σ23|21+σ21|2+σ23|2.

Finally, we assume that P{S21(0)|M23(0)}=σ31|2P{S23(0)|M23(0)} and P{S22(0)|M23(0)}=σ32|2P{S22(0)|M23(0)}, where the parameters σ31|2 and σ32|2 modulate the odds of a mutation in M23(0) matching the germline sequence and matching neither the target antibody sequence, respectively, relative to a mutation matching the bnAb sequence. Since P{S21(0)|M23(0)}+P{S22(0)|M23(0)}+P{S23(0)|M23(0)}=1, we deduce that P{S21(0)|M23(0)}=σ31|21+σ31|2+σ32|2, P{S22(0)|M23(0)}=σ32|21+σ31|2+σ32|2, and P{S23(0)|M23(0)}=11+σ31|2+σ32|2.

Since π1|2=P{S22(0)|M21(0)}P{M21(0)|M2}, the above assumptions lead to π1|2=ρ1|2σ12|21+σ12|2+σ13|2L21(S(0))L2. Likewise, π2|2=ρ1|2σ13|21+σ12|2+σ13|2L21(S(0))L2, π3|2=ρ2|2σ21|21+σ21|2+σ23|2L22(S(0))L2, π4|2=ρ2|2σ23|21+σ21|2+σ23|2L22(S(0))L2, π5|2=ρ3|2σ31|21+σ31|2+σ32|2L23(S(0))L2, π6|2=ρ3|2σ32|21+σ31|2+σ32|2L23(S(0))L2, and π7|2=1-∑i=16πi|2.

A branching process of convergent evolution

In a clone started from a naive B cell, the BCR sequence of the founder B cell is such that L(S)=(L1,0,L2,0,0) because it is unmutated. As cells divide, mutations accumulate in the clonal family, and BCR sequences S accumulate mutations, and the collection of vectors L(S) represents the position of the clonal family with respect to the germline and bnAb sequences. Here we investigate whether the BCR repertoire converges to a bnAb, and whether convergence to a bnAb requires a highly favorable set of circumstances.

To describe the intra-clonal evolution of the distances L(S), we define a multitype age-dependent branching process in which every cell is assigned a type represented by a vector ℓ that takes values in the setK={ℓ=(ℓ1,⋯,ℓ5)∈N5:ℓ1+ℓ2=L1;ℓ3+ℓ4+ℓ5=L2},

where N={0,1…} represents the set of non-negative integers. The entries of ℓ are interpreted just as those of L(S), as described in Sect. 6.4.

For every (ℓ(0),ℓ(1),ℓ(2))∈K×K×K, the conditional probability that any cell of type ℓ(0) divides into one cell of type ℓ(1) and one cell of type ℓ(2), given it divides, is assumed to be22 qℓ(1)ℓ(2)(0)=1-π~ifnomutationoccurs,andℓ(1)=ℓ(2)=ℓ(0)π~πa(0)πi|a(0)ifℓ(1)=ℓ(2)=ℓ(0)+ei|a0otherwise.

The first equation specifies the probability of no mutation occurring. The second one specifies the probability of a mutation occurring in Va according to Case a.i, as described in Sect. 6.4, with both daughters inheriting the same set of mutations from their mother. The third equation reflects the assumption that both daughter cells cannot inherit different mutations from their mother.

We assume that the probability of death and the lifespan distribution of every cell are independent of its type: p0ℓ=p0 and Gℓ(·)≡G(·), ℓ∈K. This assumption is motivated by the aggregation of positions and amino acid substitutions in defining the five regions, as discussed in Sect. 6.2. Together with the conditional probabilities qℓ(1)ℓ(1)(0), they model the combined outcome of mutation and antigen-mediated selection. Because it does not distinguish these two processes, the proposed model is partly phenomenological. The entries of M=(mℓ(0)ℓ(1))ℓ(0),ℓ(1)∈K are given by mℓ(0)ℓ(1)=2(1-p0)qℓ(1)ℓ(1)(0), such that M=2(1-p0)Q where Q=(qℓ(1)ℓ(1)(0))ℓ(0),ℓ(1)∈K.

Proposition 5

Suppose that Q is irreducible, p0<1/2, and (A4) holds. Let G∗(·) and G∗,-1(·) denote the Laplace transform of G(·) and the inverse of G∗(·). Then, as t→∞, e-αtZ(t)⟶a.s.Wv where α=G∗,-1(1/(2(1-p0))) and v=(vℓ)ℓ∈K is the left eigenvector of Q associated with its eigenvalue 1 and such that ∑ℓ∈Kvℓ=K.

See Sect. 7.4 for a proof. The irreducibility assumption on Q holds, for example, if mutations in V1 and V2 are reversible. It follows from Proposition 5 that, conditional on survival (i.e., W>0), the frequency of mutations within a clone converges a.s. over time; specifically,23 Z(t)∑ℓ∈KZℓ(t)=e-αtZ(t)∑ℓ∈Ke-αtZℓ(t)⟶a.s.vKast→∞,

such that the entries of the vector v/K provide the asymptotic mean frequency of the number of positions of V falling into the subsets Vab, (a,b)∈{(1,1),(1,2), (2,1),(2,2),(2,3)}, in expanded clones.Fig. 8 Top row: Amino acid sequences of the VH1-2*02 gene, V gene-encoded region of the heavy chain of VRC01 and of an arbitrary BCR. The 41 amino acids of VRC01 that differ from those of the germline VH1-2*02 gene form the subset V2 and are painted in red; the remaining 57 amino acids (black) define V1. In the BCR sequence example, grey amino acids define V11(S), those painted in red define V12(S), those in purple define V21(S), those in blue define V22(S), and those in green define V23(S). See Sect. 6.3 for a definition of these subsets. Second row: Number of mutated amino acids versus net mutational gain/loss in BCR sequences sampled from the B cell repertoire of several individuals, compared to four HIV-1 bnAbs (3BNC117, VRC01, IOMA, DH270.1) encoded by VH1-2*02. Third to fifth row: Number of mutated amino acids versus net mutational gain/loss in individual cells for several values of ρ1 from simulations of a branching process. Each dot represents one cell or BCR, and each color identifies one clonal family. We set σ12|1=110 in row 3, σ12|1=12 in row 4, σ12|1=45 in row 5. See Sect. 6.7 for detail (color figure online)

Drift of the BCR repertoire relative to HIV bnAbs

We randomly selected 1000 BCR sequences sampled from human subjects, none of which were living with HIV (Guo et al. 2019). All BCR were inferred to be encoded by the VH1-2*02 allele. We calculated the number of mutations relative to VH1-2*02 and the net mutational gain/loss against four HIV bnAbs: VRC01, 3BNC117, IOMA, DH270.1, all originating from VH1-2*02 (Fig. 8, middle row). As expected, BCR induced by antigens unrelated to HIV preferentially accumulate mutations that are distinct from those observed in the HIV bnAbs, as evidenced by the amount of mutational losses increasing with the number of mutations. Thus, sequential HIV vaccines may have to select for rare mutations to steer antibodies toward bnAbs. The data also suggest that inducing bnAb-specific mutations is more challenging for some bnAbs than other, as indicated by the faster drift of some BCRs away from IOMA and DH270.1 relative to 3BNC117 and VRC01. Fig. 9 Mutational paths toward a targeted antibody sequence. Each horizontal block of adjacent vertical bars represents one antibody sequence, partitioned into nucleotide positions. Arrows represent one-nucleotide mutations between antibody sequences. This diagram gives a simplified overview of the sets of mutational paths induced by somatic hypermutations started from an unmutated (germline) antibody sequence toward a targeted antibody sequence. Progression toward the targeted antibody may be hampered by the fact that as sequences accumulate targeted mutations, the number of candidate unfavorable mutations increases relative to those that are favorable. When the antibody is one mutation away from the target, the remaining mutation is up against all other potential mutations. This challenge may be collectively addressed by the multiple B cells from a clonal family that may express identical or similar antibody sequences, each offering a chance of successfully mutating toward the targeted sequence

To interpret this observation, we used our model to first examine the evolution of the BCR repertoire relative to VRC01. We set the probability of death (p0) to 410 to ensure the survival of clonal families while preventing excessive expansion for computational feasibility. The V segment of heavy chains accounts for slightly less than half of the variable domain, but is somewhat more prone to somatic hypermutations than other parts of the BCR. Therefore, taking Allen et al. (1987)’s estimate of the mutation rate into consideration, we set the probability of mutation in the V segment (π~) to 14. The mutation rate may differ between V1 and V2, partly because some bnAb-specific mutations may be much less frequent than non-bnAb specific mutations. These probabilities also depend on the antigens to which B cells are exposed. Thus, we considered several values of ρ1=110,14,12,34,910 to perform a sensitivity analysis. The BCR sequencing data used in our analysis resulted from exposures to highly diverse antigens. Therefore, we do not expect the per-position mutation rates to differ between the sets Vab(S(0)), and put ρ1|1=ρ1|2=ρ2|2=1. As argued in Sect. 6.5, we set σ1|1=13 to specify the likelihood of a mutation in V11(S(0)) being synonymous. To specify the probability of a mutation in V12(S(0)) not reverting to a germline amino acid, we set σ2|1=110. This choice is based on several considerations. Firstly, in the best-case scenario where reverting to a germline amino acid requires a single mutation, most substitutions at the wobble base, which may account for approximately one-third of all mutations, would not qualify. Among the remaining two-thirds of potential mutations at the first and second bases, only those that induce the specific germline amino acid would produce a reverse mutation, acknowledging however that the (effective) average number of candidate amino acid mutations is likely lower than 19 (ignoring mutations into stop codons). Furthermore, as mutations accumulate, some positions may require two or even more simultaneous mutations to revert to the germline amino acid. With an effective average number of five amino acid mutations, we might expect σ2|1≃215 in the best-case scenario; accounting for cases requiring more than one mutations provides support for setting σ2|1=110 or lower. We note that the choice of σ2|1 has limited impact if L12(S(0))/L1 is small. Following a similar line of arguments, we set σ12|1=110 to specify the probability of a mutation in V12(S(0)) matching the bnAb amino acid, acknowledging that a lower value may be more appropriate to study drift of the B cell repertoire following exposure to HIV-related antigens which may induce bnAb-like mutations with higher probability. Thus, we explored values of σ12|1=15 and σ12|1=12 in sensitivity analyses. Based on previous arguments regarding synonymous mutations, we set P{S21(0)|M21(0)}=13. Hence, P{S22(0)|M21(0)}+P{S23(0)|M21(0)}=23 which gives σ13|2=2-σ12|2 after algebraic calculations, and we set σ13|2=1910. Justified by a similar line of arguments, we set σ21|2=110 and σ23|2=1910. Finally, we assume that σ31|2=σ32|2=110 using the line of arguments used to justify setting σ12|2=110.

Results from simulations are displayed in Fig. 8, sorted by values of ρ1 (columns) and σ12|1 (rows). When σ12|1=110, overall, patterns observed in simulations are similar to those from BCR sequencing data, indicating a tendency of the BCR repertoire to drift away from the bnAb as mutations accumulate in the V segment, unless ρ1 is close to 0; for example, ρ1≤110, reflecting that the per-position mutation rate is at least 10 times higher in V2 than in V1. In the absence of selection bias (ρ1=1), mutations would appear in V2 with a probability of 41.8% (=4198×100%). Thus, even with almost 50% chance of inducing a mutation in V2, the BCR repertoire is expected to rapidly drift away from VRC01 (see panel with ρ=1.0) because the bnAb amino acid is only one of the candidate mutations. Our simulations suggest a value of ρ1≃0.5 for VRC01, indicating that affinity maturation during exposures to HIV-unrelated antigens has a preferential bias for inducing mutations at positions at which VRC01 and VH1-2*02 do not match, and that the probability of this happening is about twice as large compared to if there was no selection bias (i.e., case where ρ1=1). The results obtained by increasing σ12|1 to 12 or 45 suggest that this parameter has some but relatively limited influence on the results, with its impact decreasing with ρ.

The value of ρ1 appeared to differ between the four bnAbs. After accounting for the number of mutations in their respective V segment, simulations suggested the following values of ρ1: ρ1≃0.5 for 3BNC117 and ρ1≥0.9 for both IOMA and DH270.1. Thus, induction of mutations in V2 were less likely for IOMA and DH270.1 than for VRC01 and 3BNC117. One potential explanation is the fact that VRC01 and 3BNC117 are more mutated than IOMA and DH270.1, making the induction of VRC01- and 3BNC117-like mutations easier. Typically, as BCRs approach a targeted antibody, the challenge of accumulating additional advantageous mutations tends to increase because the probability of encountering unfavorable mutations eventually surpasses that of favorable ones, as illustrated in Fig. 9. This could result in a slowdown in progress as B cells approach the target. The point of equilibrium towards which members of a clonal family tend to gravitate is formally described in Proposition 5 and equation (23).

Appendices: Proofs

Proof of Proposition 2

We begin the proof with the Bray–Curtis index. Since Assumption (A4) holds and W>0, we have for δ≥0 and t large enough thatBCZ(t,t+δ)=∑k=1K|(vkWeαt-vkWeα(t+δ))(1+o(1))|∑k′=1K(vk′Weαt+vk′Weα(t+δ))(1+o(1))=∑k=1Kvk|eαt-eα(t+δ)|(1+|o(1)|)∑k′=1Kvk′eαt(1+eαδ)(1+|o(1)|)=∑k=1Kvk|1-e-αδ|(1+|o(1)|)∑k′=1Kvk′(1+eαδ)(1+|o(1)|).

Therefore, a.s., limt→∞BCZ(t;t+δ)=(1-e-αδ)/(1+eαδ). This establishes the first statement. Derivation of the other results of Proposition 2 uses similar arguments and are not provided.

Proof of Proposition 3

We have for every k=1,2… that limt→∞e-αtZk(k)(t-Tk)=Wkce-αTk (a.s.) for some constant c>0. Let Wk(u)=e-αuZk(k)(u)/c.

We first show that the series ∑k=1∞Wkce-αTk converges a.s. by verifying the conditions of Kolmogorov’s Three Series Theorem. Let A>0, arbitrary. To prove the first condition, notice that∑k=1∞P{Wke-αTk≥A}≤∑k=1∞E(Wke-αTk)A=1A∑k=1∞E(e-αTk)=1A∑k=1∞1+αr0-k=1A11-1+αr0-1-1=1Ar0α<∞,

where we have used the assumption that α>0. To prove the second condition, we have that24 ∑k=1∞E(Wke-αTk1{Wke-αTk≤A})≤∑k=1∞E(e-αTk)=r0α<∞.

Lastly, the following inequality proves the third condition:∑k=1∞Var(Wke-αTk1{Wke-αTk≤A})≤∑k=1∞E(Wk2)E(e-2αTk)=r0μW2α<∞.

The three inequalities above show that the conditions of the Three series Theorem hold. Now, limt→∞e-αtY(t)=∑k=1∞Wkce-αTk>0 (a.s.). Hence,limt→∞Fk(t)=a.s.Wke-αTk∑k′=1∞Wk′e-αTk′.

This completes the proof of the first statement of Proposition 3.

Next, to get the limit of JY(t,t+δ), let a(t,δ)=∑k=1Π(t)1{Wk(t+δ-Tk)>0}, the number of clones started before or at time t and alive at time t+δ. Then,25 JY(t,t+δ)=1-a(t,δ)a(t,0)+a(t+δ,0)-a(t,δ).

Now, for every t,δ≥0, a(t,δ) satisfies the inequalities26 ∑k=1Π(t-f(t))1{Wk(t+δ-Tk)>0}≤a(t,δ)≤∑k=1Π(t-f(t))1{Wk(t+δ-Tk)>0}+Π(t)-Π(t-f(t)).

Consider first the left-hand side, normalized by Π(t-f(t)). Then,limt→∞1Π(t-f(t))∑k=1Π(t-f(t))1{Wk(t+δ-Tk)>0}=limℓ→∞1ℓ∑k=1ℓ1{Wk>0}+limt→∞1Π(t-f(t))∑k=1Π(t-f(t))(1{Wk(t+δ-Tk)>0}-1{Wk>0}⏟≥0).

The first term in the right-hand side converges a.s. to P{W1>0} by a Strong Law of Large Numbers for i.i.d. r.v.. For the second one, notice thatP1Π(t-f(t))∑k=1Π(t-f(t))(1{Wk(t+δ-Tk)>0}-1{Wk>0})>ϵ=∑ℓ=0∞P∑k=1ℓ(1{Wk(t+δ-Tk)>0}-1{Wk>0})>ℓϵ|Π(t-f(t))=ℓPΠ(t-f(t))=ℓ≤∑ℓ=0∞∑k=1ℓ(P{Wk(t+δ-Tk)>0|Π(t-f(t))=ℓ}-P{Wk>0})ℓϵ.

Since P{Wk(t+δ-Tk)>0|Π(t-f(t))=ℓ}-P{Wk>0} is a monotone function in t for every k,ℓ, we can exchange limit and summation to obtainlimt→∞P1Π(t-f(t))∑k=1Π(t-f(t))(1{Wk(t+δ-Tk)>0}-1{Wk>0})>ϵ≤∑ℓ=0∞∑k=1ℓlimt→∞P{Wk(t+δ-Tk)>0|Π(t-f(t))=ℓ}-P{Wk>0}ℓϵ=0.

We conclude that, for every δ≥0,limt→∞1Π(t)∑k=1Π(t-f(t))1{Wk(t+δ-Tk)>0}→Plimt→∞R(t-f(t))R(t)P{W1>0}=P{W1>0}.

Proceeding similarly, we show that the right-hand side of (26) normalized by Π(t) also converges in probability to P{W1>0}. Therefore, for every δ≥0, a(t,δ)/Π(t)⟶PP{W1>0} as t→0. We finally deduce from (25) that JY(t,t+δ)⟶P0 as t→∞. Next, to prove the limit of BCY(t,t+δ), we writeBCY(t,t+δ)=∑k=1∞cWk|e-αTk-e-α(Tk-δ)||1+o(1)|e-αtY(t)+e-αtY(t+δ)1{Tk≤t+δ}.

Using previous results, we show thatlimt→∞BCY(t,t+δ)=a.s.∑k=1∞cWk|e-αTk-e-α(Tk-δ)|limt→∞e-αtY(t)+limt→∞e-αtY(t+δ),

from which the result follows. To establish the limit of the Bhattacharyya coefficient, notice that for every δ≥0limt→∞BY(t,t+δ)=∑k=1∞limt→∞e-αtZk(k)(t-Tk)1{k≤Π(t+δ)}limt→∞e-αtY(t)×limt→∞e-α(t+δ)Zk(k)(t+δ-Tk)1{k≤Π(t+δ)}limt→∞e-αtY(t+δ)=a.s.∑k=1∞Wke-αTk∑k′=1∞Wk′e-αTk′Wke-αTk∑k′=1∞Wk′e-αTk′=a.s.1,

To establish the limit of the proportion of similarity PY(t,t+δ), we have thatlimt→∞PY(t,t+δ)=a.s.1-12∑k=1∞|Wke-αTk∑k′=1∞Wk′e-αTk′-Wke-α(Tk-δ)∑k′=1∞Wk′e-α(Tk-δ)|,

and the result follows, completing the proof.

Proof of Proposition 4

By assumption, limt→∞R(t)=∞. Therefore, Π(t)⟶a.s.∞ as t→∞, and the immigration process a.s. generates an infinite sequence {αk}k=1∞. Let αmax=inf{x≥0:H+(x)=1} denote the upper bound of the support of the conditional distribution of α1, given α1>0. Since P{α1>0}>0 by assumption, we deduce that αmax>0. Now, H+(·) is assumed to be absolutely continuous. Hence, αk<αmax a.s., and P{αk′>max(0,αk)}>0, k′=k+1,k+2⋯. Therefore, ∑k′=k+1∞P{αk′>max(0,αk)}=∞. Since the r.v. {αk}k=1∞ are i.i.d., we deduce from the second Borel–Cantelli Lemma that there exists a.s. an infinite subsequence {αkℓ}ℓ=1∞⊆{αk′}k′=k+1∞ such that αkℓ>max(0,αk), ℓ=1,2…. Then, for every k=1,2…, e-αktZk(k)(t)⟶a.s.Wk using the assumption that ∫0∞gk(x)δdx<∞ for some δ>1 (see Assumption (A4)). The sequence {Wkℓ}ℓ=1∞ is i.i.d and such that P{Wkℓ>0}>0, ℓ=1,2…. Hence, a.s., ∃ℓ+∈{1,2…} such that Wkℓ+>0. We deduce that0≤limt→∞Fk(t)≤limt→∞Zk(k)(t-Tk)Zℓ+(kℓ+)(t-Tkℓ+)=limt→∞e-αk(t-Tk)Zk(k)(t-Tk)e-αkℓ+(t-Tkℓ+)Zℓ+(kℓ+)(t-Tkℓ+)eαk(t-Tk)eαkℓ+(t-Tkℓ+)=WkWkℓ+limt→∞eαk(t-Tk)eαkℓ+(t-Tkℓ+)=a.s.0.

This proves the first claim of Prop. 4 and its second one by setting k′=kℓ+.

Proof of Proposition 5

We have M∗(s)=G∗(s)M=2(1-p0)G∗(s)Q. Hence, the largest eigenvalue of M∗(s) is ρ∗(s)=2(1-p0)G∗(s)ρQ∗ where ρQ∗ denotes the largest eigenvalue of Q. Now, it can be shown that Q is a stochastic matrix. Therefore, ρQ∗=1, and the associated right eigenvector is u=(1K,⋯,1K). Next, since α is a solution of the equation ρ∗(α)=1, we have that G∗(α)=1/(2(1-p0)) and we deduce that α=G∗,-1(1/(2(1-p0)))>0 because the Laplace transform of a real-valued positive function is strictly decreasing. Using results from Sect. 3.6, we conclude that e-αtZ(t)⟶a.s.Wv where v is the left eigenvector of M∗(α)=2(1-p0)G∗(α)Q and the left eigenvector of Q associated with its unit eigenvalue which satisfies u1v1+⋯+uKvK=1K(v1+⋯+vK)=1.

Acknowledgements

The authors would like to express their gratitude to the Associate Editor and two anonymous reviewers for their insightful comments and constructive feedback, which contributed to the improvement of this manuscript.

Funding

Research reported in this publication was supported by the National Institute Of Allergy And Infectious Diseases of the National Institutes of Health under Award Numbers R01AI129518 and R37AI029168, and by the Bill and Melinda Gates Foundation under Award Numbers INV-032929 and INV-027499. The content is solely the responsibility of the authors and does not necessarily represent the official views of the National Institutes of Health or the Bill and Melinda Gates Foundation.

Declarations

Conflict of interest

The authors have no financial or non-financial interests that are directly or indirectly related to the work submitted for publication to declare.

Ethical approval

The BCR sequencing data analyzed during the current study are available in the cAb-Rep repository database (Guo et al. 2019).

Publisher's Note

Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.
==== Refs
References

Agur Z Mazor G Meilijson I Maturation of the humoral immune response as an optimization problem Proc R Soc Lond 1991 245 147 150
Allen D Cumano A Dildrop R Kocks C Rajewsky K Rajewsky N Roes J Sablitzky F Siekevitz M Timing, genetic requirements and functional consequences of somatic hypermutation during B-cell development Immunol Rev 1987 96 5 22 3298009
Alt FW Honjo T Radbruch A Reth M Molecular biology of B cells 2015 2 London Academic Press
Athreya KB Ney PE Branching processes 1972 Mineola, New York Dover Publications Inc
Bannard O Cyster JG Germinal centers: programmed for affinity maturation and antibody diversification Curr Opin Immunol 2017 45 21 30 28088708
Berek C Milstein C Mutation drift and repertoire shift in the maturation of the immune response Immunol Rev 1987 96 23 41 3298007
Bhattacharyya A On a measure of divergence between two multinomial populations Sankhya 1946 7 4 401 406
Buchauser L Wadermann H Calculating germinal center reactions Curr Opin Syst Biol 2019 18 1 8
Chan WF Coughlan HD Zhou JHS Pre-mitotic genome re-organisation bookends the B cell differentiation process Nat Commun 2021 12 1344 33637722
Corey L Gilbert PB Jaraska M Two randomized trials of neutralizing antibodies to prevent HIV-1 acquisition N Engl J Med 2021 384 1003 14 33730454
De Silva NS Klein U Dynamics of B cells in germinal centres Nat Rev Immunol 2015 15 137 148 25656706
Doria-Rose NA Klein RM Daniels MG O’Dell S Nason M Lapedes A Bhattacharya T Migueles SA Wyatt RT Korber BT Mascola JR Connors M Frequency and phenotype of human immunodeficiency virus envelope-specific B cells from patients with broadly cross-neutralizing antibodies J Virol 2009 83 188 199 18922865
Dreyer WJ Bennett JC The molecular basis of antibody formation: a paradox Proc Natl Acad Sci USA 1965 54 3 864 869 4160200
Durrett R Essentials of stochastic processes 2004 New York, NY Springer
Eisen H Siskind G Variations in affinities of antibodies during the immune response Biochemistry 1964 155 996 1008
Faro F Or-Guil M How oligoclonal are germinal centers? A new method for estimating clonal diversity from immunohistological sections BMC Bioinformat 2013 14 S8
Guo Y Chen K Kwong PD Shapiro L Sheng Z cAb-Rep: a database of curated antibody repertoires for exploring antibody diversity and predicting antibody prevalence Front Immunol 2019 10 2365 31649674
Harris TE The theory of branching processes 1963 Mineola, New York Dover Publications Inc.
Haynes BF Mascola JR The quest for an antibody-based HIV vaccine Immunol Rev 2017 275 5 10 28133795
Hill MO Diversity and evenness: a unifying notation and its consequences Ecology 1973 54 427 432
Hyrien O Mayer-Pröschel M Noble M Yakovlev A A stochastic model to analyze clonal data on multi-type cell populations Biometrics 2005 61 199 207 15737094
Hyrien O Chen R Mayer-Pröschel M Noble M Saddlepoint approximations to the moments of multitype age-dependent branching processes, with applications Biometrics 2010 66 567 577 19508238
Hyrien O Peslak SA Yanev NM Palis J Stochastic modeling of stress erythropoiesis using a two-type age-dependent branching process with immigration J Math Biol 2015 70 1485 1521 24989701
Hyrien O Mitov KM Yanev NM Subcritical Sevastyanov branching processes with non-homogeneous Poisson immigration J. Appl. Prob. 2017 54 569 587
Iber D Maini PK A mathematical model for germinal centre kinetics and affinity maturation J Theor Biol 2002 219 153 175 12413873
Jaccard P The distribution of the flora in the alpine zone New Phytol 1912 11 37 50
Jacob J Kelsoe G Rajewsky K Weiss U Intraclonal generation of antibody mutants in germinal centres Nature 1991 354 389 392 1956400
Jagers P Age-dependent branching processes allowing immigration Theory Prob Appl 1968 13 225 236
Jagers P Nerman O The asymptotic composition of supercritical, multitype branching populations Sém Probab (Strasbourg) 1996 30 40 54
Janeway CA, Travers P, Walport M, Shlomchik MJ (2005) Immunobiology, 6th edn. Garland Science
Jardine JG Kulp DW Havenar-Daughton C HIV-1 broadly neutralizing antibody precursor B cells revealed by germline-targeting immunogen Science 2016 351 1458 1463 27013733
Kepler TB Perelson AS Cyclic re-entry of germinal center B cells and the efficiency of affinity maturation Immunol Today 1993 14 412 415 8397781
Kepler TB Perelson AS Somatic hyper-mutation in B cells: an optimal control treatment J Theor Biol 1993 164 37 64 8264243
Kepler TB Perelson AS Modeling and optimization of populations subject to time-dependent mutation Proc Natl Acad Sci USA 1995 92 8219 8223 7667271
Kleinstein SH Singh JP Toward quantitative simulation of germinal center dynamics: biological and modeling insights from experimental validation J Theor Biol 2001 211 253 275 11444956
Kroese FG Wubbena AS Seijen HG Nieuwenhuis P Germinal centers develop oligoclonally Eur J Immunol 1987 17 7 1069 1072 3301368
Küppers R Zhao M Hansmann ML Rajewsky K Tracing B cell development in human germinal centres by molecular analysis of single cell spicked from histological sections EMBO J 1993 12 4955 4967 8262038
Kuraoka M Schmidt AG Nojima T Feng F Watanabe A Kitamura D Harrison SC Kepler TB Kelsoe G Complex antigens drive permissive clonal selection in germinal centers Immunity 2016 44 542 552 26948373
Lee JH Sutton HJ Cottrell CA Long-primed germinal centres with enduring affinity maturation and clonal migration Nature 2022 609 998 1004 36131022
Leggat DJ Cohen KW Willis J Vaccination induces HIV broadly neutralizing antibody precursors in humans Science 2022 378 964
MacLennan IC Germinal centers Annu Rev Immunol 1994 12 117 139 8011279
McKean D Huppi K Bell M Staudt L Gerhard W Weigert M Generation of antibody diversity in the immune response of BALB/c mice to influenza virus hemagglutinin Proc Natl Acad Sci USA 1984 81 3180 3184 6203114
Meyer-Hermann M Deutsch A Or-Guil M Recycling probability and dynamical properties of germinal centre reactions J Theor Biol 2001 210 265 285 11397129
Mitov K Yanev NM Hyrien O Multitype branching processes with inhomogeneous Poisson immigration Adv Appl Probab 2018 50 A 211 228
Mode CJ Multitype branching processes 1971 New York American Elsevier Pub. Co Inc.
Muramatsu M Kinoshita K Fagarasan S Yamada S Shinkai Y Honjo T Class switch recombination and hypermutation require activation-induced cytidine deaminase (AID), a potential RNA editing enzyme Cell 2000 102 553 563 11007474
Neuts MF Waitingtimes between record observations J Appl Probab 1967 4 206 208
Oprea M Perelson A Somatic mutation leads to efficient affinity maturation when centrocytes recycle back to centroblasts J Immunol 1997 158 5155 5162 9164931
Pakes AG Kaplan N On the subcritical Bellman–Harris process with immigration J Appl Probob 1974 11 65
Plotkin SA Correlates of vaccine-induced immunity Clin Infect Dis 2008 47 1 401 409 18558875
Rempala GA Seweryn M Methods for diversity and overlap analysis in T-cell receptor populations J Math Biol 2013 67 1339 1368 23007599
Resnick SI Adventures in stochastic processess 1992 Boston Birkhauser
Schwickert TA Lindquist RL Shakhar G Livshits G Skokos D Kosco-Vilbois MH Dustin ML Nussenzweig MC In vivo imaging of germinal centres reveals a dynamic open structure Nature 2007 446 83 87 17268470
Schwickert TA Alabyev B Manser T Nussenzweig MC Germinal center reutilization by newly activated B cells J Exp Med 2009 206 13 2907 2914 19934021
Sevastyanov BA Limit theorems for branching random processes of special type Theory Probob Appl 1957 2 339 348
Simpson EH Measurement of diversity Nature 1949 163 688
Slavtchova-Bojkova MN Hyrien O Yanev N Poisson random measures and supercritical multitype Markov branching processes Stoch Model 2023 39 1 141 160
Slavtchova-Bojkova M, Hyrien O, Yanev N (2023) Subcritical multitype Markov branching processes with immigration generated by Poisson random measures. Commun Stat—Theory Methods. Accessed 04 May 2023. 10.1080/03610926.2023.2205972
Steichen JM Kulp DW Tokatlian T HIV vaccine design to target germline precursors of glycan-dependent broadly neutralizing anti-bodies Immunity 2016 45 483 496 27617678
Tas JMJ Mesin L Pasqual G Targ S Jacobsen JT Mano YM Chen CS Weill JC Reynaud CA Browne EP Meyer-Hermann M Victora GD Visualizing antibody affinity maturation in germinal centers Science 2016 351 1048 1054 26912368
Tonegawa S Somatic generation of antibody diversity Nature 1983 302 575 581 6300689
Turner JS Benet ZL Grigorova IL Antigen acquisition enables newly arriving B cells to enter ongoing immunization-induced germinal centers J Immunol 2017 199 1301 1307 28687657
Weigert MG Cesari IM Yonkovich SJ Cohn M Variability in the lambda light chain sequences of mouse antibody Nature 1970 228 1045 1047 5483159
Whittaker RH Vegetation of the Siskiyou mountains, Oregon and California Ecol Monogr 1960 30 279 338
Whittaker RH Evolution and measurement of species diversity Taxon 1972 21 213 251
Yakovlev AY Yanev NM Branching stochastic processes with immigration in analysis of renewing cell populations Math Biosci 2006 2006 203 37 63
